"use strict";(self.webpackChunkhigress_website=self.webpackChunkhigress_website||[]).push([[9491],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},g="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),g=u(n),m=r,d=g["".concat(s,".").concat(m)]||g[m]||p[m]||i;return n?a.createElement(d,l(l({ref:t},c),{},{components:n})):a.createElement(d,l({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[g]="string"==typeof e?e:r,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9684:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const i={title:"Introduction to the use of Wasm plugins",keywords:["higress","wasm"],description:"Introduction to the Higress Wasm plugin"},l=void 0,o={unversionedId:"plugins/intro",id:"plugins/intro",title:"Introduction to the use of Wasm plugins",description:"Introduction to the Higress Wasm plugin",source:"@site/i18n/en-us/docusaurus-plugin-content-docs/current/plugins/intro.md",sourceDirName:"plugins",slug:"/plugins/intro",permalink:"/en-us/docs/plugins/intro",draft:!1,editUrl:"https://github.com/higress-group/higress-group.github.io/blob/main/i18n/en-us/docusaurus-plugin-content-docs/current/plugins/intro.md",tags:[],version:"current",frontMatter:{title:"Introduction to the use of Wasm plugins",keywords:["higress","wasm"],description:"Introduction to the Higress Wasm plugin"},sidebar:"docs",previous:{title:"Wasm Plugin Image Specification",permalink:"/en-us/docs/user/wasm-image-spec"},next:{title:"Custom Plugin",permalink:"/en-us/docs/plugins/custom"}},s={},u=[{value:"Configure through the Higress console",id:"configure-through-the-higress-console",level:2},{value:"Configuration via Higress WasmPlugin CRD",id:"configuration-via-higress-wasmplugin-crd",level:2},{value:"Official plugin mirror address",id:"official-plugin-mirror-address",level:3},{value:"Wasm plugin principle introduction",id:"wasm-plugin-principle-introduction",level:2},{value:"What is Wasm",id:"what-is-wasm",level:3},{value:"Plug-in effective process",id:"plug-in-effective-process",level:3},{value:"Plug-in execution sequence arrangement",id:"plug-in-execution-sequence-arrangement",level:3},{value:"How does the Wasm plugin achieve lossless traffic when changing",id:"how-does-the-wasm-plugin-achieve-lossless-traffic-when-changing",level:3}],c={toc:u},g="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(g,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"configure-through-the-higress-console"},"Configure through the Higress console"),(0,r.kt)("p",null,"The Higress console provides 3 entries for plug-in configuration:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Global configuration: plug-in market -> select plug-in to configure"),(0,r.kt)("li",{parentName:"ol"},"Domain-level configuration: domain name management->select domain name->click policy->select plug-in to configure"),(0,r.kt)("li",{parentName:"ol"},"Routing-level configuration: Routing configuration->select routing->click policy->select plug-in to configure")),(0,r.kt)("p",null,"The effective priority of these three configurations is: route level > domain name level > global"),(0,r.kt)("p",null,"That is, the global configuration will only take effect for requests that do not match a specific route or domain name"),(0,r.kt)("p",null,"For general plugins, including custom plugins, the routing/domain name level configuration fields are exactly the same as the global configuration fields;"),(0,r.kt)("p",null,"For authentication plug-ins (Key authentication, HMAC authentication, Basic authentication, JWT authentication, etc.), it is different. The global configuration only configures the Consumer credential and whether to enable global authentication, and configures the allowed access through the ",(0,r.kt)("inlineCode",{parentName:"p"},"allow")," field at the routing/domain name level. Consumer list, for details, please refer to ",(0,r.kt)("a",{parentName:"p",href:"/en-us/docs/plugins/key-auth"},"Configuration Instructions")," of Key Authentication"),(0,r.kt)("h2",{id:"configuration-via-higress-wasmplugin-crd"},"Configuration via Higress WasmPlugin CRD"),(0,r.kt)("p",null,"The Higress WasmPlugin CRD extends the Istio ",(0,r.kt)("a",{parentName:"p",href:"https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/#WasmPlugin"},"WasmPlugin")," CRD, adding the following configuration fields:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Data Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Filling Requirements"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"defaultConfig")),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional"),(0,r.kt)("td",{parentName:"tr",align:null},"The default configuration of the plugin, which takes effect globally for requests that do not match specific domain names and routing configurations")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"matchRules")),(0,r.kt)("td",{parentName:"tr",align:null},"array of object"),(0,r.kt)("td",{parentName:"tr",align:null},"optional"),(0,r.kt)("td",{parentName:"tr",align:null},"configurations that match domain names or routes to take effect")))),(0,r.kt)("p",null,"Description of configuration fields for each item in ",(0,r.kt)("inlineCode",{parentName:"p"},"matchRules"),":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Data Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Filling Requirements"),(0,r.kt)("th",{parentName:"tr",align:null},"Configuration Example"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ingress")),(0,r.kt)("td",{parentName:"tr",align:null},"array of string"),(0,r.kt)("td",{parentName:"tr",align:null},"one of ",(0,r.kt)("inlineCode",{parentName:"td"},"ingress")," and ",(0,r.kt)("inlineCode",{parentName:"td"},"domain")," is required"),(0,r.kt)("td",{parentName:"tr",align:null},'["default/foo","default/bar"]'),(0,r.kt)("td",{parentName:"tr",align:null},"Matching ingress resource object, the matching format is: ",(0,r.kt)("inlineCode",{parentName:"td"},"namespace/ingress name"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"domain")),(0,r.kt)("td",{parentName:"tr",align:null},"array of string"),(0,r.kt)("td",{parentName:"tr",align:null},"one of ",(0,r.kt)("inlineCode",{parentName:"td"},"ingress")," and ",(0,r.kt)("inlineCode",{parentName:"td"},"domain")," is required"),(0,r.kt)("td",{parentName:"tr",align:null},'["example.com","*.test.com"]'),(0,r.kt)("td",{parentName:"tr",align:null},"match domain name, support generic domain name")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"config")),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"optional"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"plug-in configuration that takes effect after matching")))),(0,r.kt)("p",null,"Take the ",(0,r.kt)("a",{parentName:"p",href:"/en-us/docs/plugins/request-block"},"Request Blocking")," plugin as an example, if you want the following configuration of the plugin to take effect globally (please refer to the ",(0,r.kt)("a",{parentName:"p",href:"/en-us/docs/plugins/request-block"},"Request Blocking")," document for configuration field descriptions):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"block_urls:\n- swagger.html\n- foo=bar\ncase_sensitive: false\n")),(0,r.kt)("p",null,"Then the corresponding WasmPlugin needs to be configured as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: extensions.higress.io/v1alpha1\nkind: WasmPlugin\nmetadata:\n   name: request-block\n   namespace: higress-system\nspec:\n   defaultConfig:\n     block_urls:\n     - swagger.html\n     - foo=bar\n     case_sensitive: false\n   url: oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/request-block:1.0.0\n")),(0,r.kt)("p",null,"The following requests will be blocked immediately after configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://example.com?foo=Bar\ncurl http://exmaple.com/foo/Swagger.html\n")),(0,r.kt)("p",null,"If you want to apply the following configuration to the Ingress named foo under the default namespace (matching requests whose path prefix is ",(0,r.kt)("inlineCode",{parentName:"p"},"/foo"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"block_headers:\n- example-key\n- example-value\n")),(0,r.kt)("p",null,"Then the corresponding WasmPlugin needs to be configured as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: extensions.higress.io/v1alpha1\nkind: WasmPlugin\nmetadata:\n   name: request-block\n   namespace: higress-system\nspec:\n   defaultConfig:\n     block_urls:\n     - swagger.html\n     - foo=bar\n     case_sensitive: false\n   matchRules:\n    # Route-level effective configuration\n   - ingress:\n     - default/foo\n      # The ingress named foo under the default namespace will execute the following configuration\n     config:\n       block_headers:\n       - example-key\n       - example-value\n   url: oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/request-block:1.0.0\n")),(0,r.kt)("p",null,"After configuration, the following request will not match a specific ingress, so it still hits the global default configuration and is denied access:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://example.com?foo=Bar\n")),(0,r.kt)("p",null,"Since the following request matches the Ingress of foo, the routing-level configuration is not affected by the default configuration and will not be denied access:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://exmaple.com/foo/Swagger.html\n")),(0,r.kt)("p",null,"Because the route-level configuration blocks requests with ",(0,r.kt)("inlineCode",{parentName:"p"},"example-key")," characters in the request header, the following request will be denied access:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://exmaple.com/foo -H 'exmaple-key: 123'\n")),(0,r.kt)("p",null,"When there are multiple rules in ",(0,r.kt)("inlineCode",{parentName:"p"},"matchRules"),", they will be matched according to the order of the rules. It is recommended to place the ingress matching configuration before the domain matching, which is also the practice of the Higress console"),(0,r.kt)("h3",{id:"official-plugin-mirror-address"},"Official plugin mirror address"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Plugin name"),(0,r.kt)("th",{parentName:"tr",align:null},"Mirror address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Key authentication"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/key-auth:1.0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Basic authentication"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/basic-auth:1.0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"HMAC authentication"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/hmac-auth:1.0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JWT authentication"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/jwt-auth:1.0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Bot detection"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/bot-detect:1.0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Custom Response"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/custom-response:1.0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"request block"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/request-block:1.0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Key-based rate limit"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/key-rate-limit:1.0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"WAF Protection"),(0,r.kt)("td",{parentName:"tr",align:null},"higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/waf:1.0.0")))),(0,r.kt)("h2",{id:"wasm-plugin-principle-introduction"},"Wasm plugin principle introduction"),(0,r.kt)("h3",{id:"what-is-wasm"},"What is Wasm"),(0,r.kt)("p",null,"// TODO..."),(0,r.kt)("h3",{id:"plug-in-effective-process"},"Plug-in effective process"),(0,r.kt)("p",null,"// TODO..."),(0,r.kt)("h3",{id:"plug-in-execution-sequence-arrangement"},"Plug-in execution sequence arrangement"),(0,r.kt)("p",null,"// TODO..."),(0,r.kt)("h3",{id:"how-does-the-wasm-plugin-achieve-lossless-traffic-when-changing"},"How does the Wasm plugin achieve lossless traffic when changing"),(0,r.kt)("p",null,"// TODO..."))}p.isMDXComponent=!0}}]);