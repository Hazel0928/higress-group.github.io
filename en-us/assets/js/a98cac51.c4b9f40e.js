"use strict";(self.webpackChunkhigress_website=self.webpackChunkhigress_website||[]).push([[2726],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>k});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),u=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=u(e.components);return r.createElement(p.Provider,{value:t},e.children)},d="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),d=u(n),c=a,k=d["".concat(p,".").concat(c)]||d[c]||s[c]||i;return n?r.createElement(k,l(l({ref:t},m),{},{components:n})):r.createElement(k,l({ref:t},m))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[d]="string"==typeof e?e:a,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7179:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>s,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const i={title:"Rate limiting based on Key",keywords:["higress","rate limit"],description:"Key rate limiting plug-in configuration reference"},l=void 0,o={unversionedId:"plugins/traffic/key-rate-limit",id:"plugins/traffic/key-rate-limit",title:"Rate limiting based on Key",description:"Key rate limiting plug-in configuration reference",source:"@site/i18n/en-us/docusaurus-plugin-content-docs/current/plugins/traffic/key-rate-limit.md",sourceDirName:"plugins/traffic",slug:"/plugins/traffic/key-rate-limit",permalink:"/en-us/docs/plugins/traffic/key-rate-limit",draft:!1,editUrl:"https://github.com/higress-group/higress-group.github.io/blob/main/i18n/en-us/docusaurus-plugin-content-docs/current/plugins/traffic/key-rate-limit.md",tags:[],version:"current",frontMatter:{title:"Rate limiting based on Key",keywords:["higress","rate limit"],description:"Key rate limiting plug-in configuration reference"},sidebar:"docs",previous:{title:"request blocking",permalink:"/en-us/docs/plugins/traffic/request-block"},next:{title:"cluster-key-rate-limit",permalink:"/en-us/docs/plugins/traffic/cluster-key-rate-limit"}},p={},u=[{value:"Description",id:"description",level:2},{value:"Configuration Fields",id:"configuration-fields",level:2},{value:"Configuration Samples",id:"configuration-samples",level:2},{value:"Use query parameter <code>apikey</code> for rate-limiting",id:"use-query-parameter-apikey-for-rate-limiting",level:3},{value:"Use HTTP header parameter <code>x-ca-key</code> for rate-limiting",id:"use-http-header-parameter-x-ca-key-for-rate-limiting",level:3},{value:"Enable rate-limiting for specific routes or domains",id:"enable-rate-limiting-for-specific-routes-or-domains",level:3}],m={toc:u},d="wrapper";function s(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"description"},"Description"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"key-rate-limit")," plugin implements a rate-limiting function based on specific key-values. The key-values may come from URL parameters or HTTP headers."),(0,a.kt)("h2",{id:"configuration-fields"},"Configuration Fields"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Requirement"),(0,a.kt)("th",{parentName:"tr",align:null},"Default Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"limit_by_header"),(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"Optional. Choose one from following: ",(0,a.kt)("inlineCode",{parentName:"td"},"limit_by_header"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"limit_by_param"),"."),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"The name of HTTP header used to obtain key-value used in rate-limiting.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"limit_by_param"),(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"Optional. Choose one from following: ",(0,a.kt)("inlineCode",{parentName:"td"},"limit_by_header"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"limit_by_param"),"."),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"The name of URL parameter used to obtain key-value used in rate-limiting.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"limit_keys"),(0,a.kt)("td",{parentName:"tr",align:null},"array of object"),(0,a.kt)("td",{parentName:"tr",align:null},"Required"),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"Rate-limiting thresholds when matching specific key-values")))),(0,a.kt)("p",null,"Field descriptions of ",(0,a.kt)("inlineCode",{parentName:"p"},"limit_keys")," items:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Requirement"),(0,a.kt)("th",{parentName:"tr",align:null},"Default Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"key"),(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"Required"),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"Value to match of the specific key")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"query_per_second"),(0,a.kt)("td",{parentName:"tr",align:null},"number"),(0,a.kt)("td",{parentName:"tr",align:null},"Optional. Choose one from following: ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_second"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_minute"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_hour"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_day"),"."),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"Number of requests allowed per second")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"query_per_minute"),(0,a.kt)("td",{parentName:"tr",align:null},"number"),(0,a.kt)("td",{parentName:"tr",align:null},"Optional. Choose one from following: ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_second"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_minute"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_hour"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_day"),"."),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"Number of requests allowed per minute")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"query_per_hour"),(0,a.kt)("td",{parentName:"tr",align:null},"number"),(0,a.kt)("td",{parentName:"tr",align:null},"Optional. Choose one from following: ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_second"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_minute"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_hour"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_day"),"."),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"Number of requests allowed per hour")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"query_per_day"),(0,a.kt)("td",{parentName:"tr",align:null},"number"),(0,a.kt)("td",{parentName:"tr",align:null},"Optional. Choose one from following: ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_second"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_minute"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_hour"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query_per_day"),"."),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"Number of requests allowed per day")))),(0,a.kt)("h2",{id:"configuration-samples"},"Configuration Samples"),(0,a.kt)("h3",{id:"use-query-parameter-apikey-for-rate-limiting"},"Use query parameter ",(0,a.kt)("inlineCode",{parentName:"h3"},"apikey")," for rate-limiting"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"limit_by_param: apikey\nlimit_keys:\n- key: 9a342114-ba8a-11ec-b1bf-00163e1250b5\n  query_per_second: 10\n- key: a6a6d7f2-ba8a-11ec-bec2-00163e1250b5\n  query_per_minute: 100\n")),(0,a.kt)("h3",{id:"use-http-header-parameter-x-ca-key-for-rate-limiting"},"Use HTTP header parameter ",(0,a.kt)("inlineCode",{parentName:"h3"},"x-ca-key")," for rate-limiting"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"limit_by_header: x-ca-key\nlimit_keys:\n- key: 102234\n  query_per_second: 10\n- key: 308239\n  query_per_hour: 10\n")),(0,a.kt)("h3",{id:"enable-rate-limiting-for-specific-routes-or-domains"},"Enable rate-limiting for specific routes or domains"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'# Use _rules_ field for fine-grained rule configurations\n_rules_:\n# Rule 1: Match by route name\n- _match_route_:\n  - route-a\n  - route-b\n  limit_by_header: x-ca-key\n  limit_keys:\n  - key: 102234\n    query_per_second: 10\n# Rule 2: Match by domain\n- _match_domain_:\n  - "*.example.com"\n  - test.com\n  limit_by_header: x-ca-key\n  limit_keys:\n  - key: 102234\n    query_per_second: 100\n')),(0,a.kt)("p",null,"In the rule sample of ",(0,a.kt)("inlineCode",{parentName:"p"},"_match_route_"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"route-a")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"route-b")," are the route names provided when creating a new gateway route. When the current route names matches the configuration, the rule following shall be applied.\nIn the rule sample of ",(0,a.kt)("inlineCode",{parentName:"p"},"_match_domain_"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"*.example.com")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"test.com")," are the domain names used for request matching. When the current domain name matches the configuration, the rule following shall be applied.\nAll rules shall be checked following the order of items in the ",(0,a.kt)("inlineCode",{parentName:"p"},"_rules_")," field, The first matched rule will be applied. All remained will be ignored."))}s.isMDXComponent=!0}}]);