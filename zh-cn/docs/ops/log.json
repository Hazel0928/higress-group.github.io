{
  "filename": "log.md",
  "__html": "<h1>日志说明</h1>\n<p>Higress 默认使用的日志格式为 JSON 格式，如下所示:</p>\n<pre><code class=\"language-json\">{\n\t<span class=\"hljs-attr\">\"authority\"</span>: <span class=\"hljs-string\">\"%REQ(:AUTHORITY)%\"</span>,\n\t<span class=\"hljs-attr\">\"bytes_received\"</span>: <span class=\"hljs-string\">\"%BYTES_RECEIVED%\"</span>,\n\t<span class=\"hljs-attr\">\"bytes_sent\"</span>: <span class=\"hljs-string\">\"%BYTES_SENT%\"</span>,\n\t<span class=\"hljs-attr\">\"downstream_local_address\"</span>: <span class=\"hljs-string\">\"%DOWNSTREAM_LOCAL_ADDRESS%\"</span>,\n\t<span class=\"hljs-attr\">\"downstream_remote_address\"</span>: <span class=\"hljs-string\">\"%DOWNSTREAM_REMOTE_ADDRESS%\"</span>,\n\t<span class=\"hljs-attr\">\"duration\"</span>: <span class=\"hljs-string\">\"%DURATION%\"</span>,\n\t<span class=\"hljs-attr\">\"method\"</span>: <span class=\"hljs-string\">\"%REQ(:METHOD)%\"</span>,\n\t<span class=\"hljs-attr\">\"path\"</span>: <span class=\"hljs-string\">\"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\"</span>,\n\t<span class=\"hljs-attr\">\"protocol\"</span>: <span class=\"hljs-string\">\"%PROTOCOL%\"</span>,\n\t<span class=\"hljs-attr\">\"request_id\"</span>: <span class=\"hljs-string\">\"%REQ(X-REQUEST-ID)%\"</span>,\n\t<span class=\"hljs-attr\">\"requested_server_name\"</span>: <span class=\"hljs-string\">\"%REQUESTED_SERVER_NAME%\"</span>,\n\t<span class=\"hljs-attr\">\"response_code\"</span>: <span class=\"hljs-string\">\"%RESPONSE_CODE%\"</span>,\n\t<span class=\"hljs-attr\">\"response_flags\"</span>: <span class=\"hljs-string\">\"%RESPONSE_FLAGS%\"</span>,\n\t<span class=\"hljs-attr\">\"route_name\"</span>: <span class=\"hljs-string\">\"%ROUTE_NAME%\"</span>,\n\t<span class=\"hljs-attr\">\"start_time\"</span>: <span class=\"hljs-string\">\"%START_TIME%\"</span>,\n\t<span class=\"hljs-attr\">\"trace_id\"</span>: <span class=\"hljs-string\">\"%REQ(X-B3-TRACEID)%\"</span>,\n\t<span class=\"hljs-attr\">\"upstream_cluster\"</span>: <span class=\"hljs-string\">\"%UPSTREAM_CLUSTER%\"</span>,\n\t<span class=\"hljs-attr\">\"upstream_host\"</span>: <span class=\"hljs-string\">\"%UPSTREAM_HOST%\"</span>,\n\t<span class=\"hljs-attr\">\"upstream_local_address\"</span>: <span class=\"hljs-string\">\"%UPSTREAM_LOCAL_ADDRESS%\"</span>,\n\t<span class=\"hljs-attr\">\"upstream_service_time\"</span>: <span class=\"hljs-string\">\"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\"</span>,\n\t<span class=\"hljs-attr\">\"upstream_transport_failure_reason\"</span>: <span class=\"hljs-string\">\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\"</span>,\n\t<span class=\"hljs-attr\">\"user_agent\"</span>: <span class=\"hljs-string\">\"%REQ(USER-AGENT)%\"</span>,\n\t<span class=\"hljs-attr\">\"x_forwarded_for\"</span>: <span class=\"hljs-string\">\"%REQ(X-FORWARDED-FOR)%\"</span>\n}\n</code></pre>\n<p>Value 的配置含义可以参考<a href=\"https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#config-access-log\"> envoy 日志说明</a></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">字段名</th>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">authority</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">请求报文中的Host Header。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">bytes_received</td>\n<td style=\"text-align:left\">long</td>\n<td style=\"text-align:left\">请求的Body大小（不包含Header）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">bytes_sent</td>\n<td style=\"text-align:left\">long</td>\n<td style=\"text-align:left\">响应的Body大小（不包含Header）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">downstream_local_address</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">网关Pod地址。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">downstream_remote_address</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">连接到网关的Client端地址。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">duration</td>\n<td style=\"text-align:left\">long</td>\n<td style=\"text-align:left\">请求整体耗时。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">method</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">HTTP方法。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">path</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">HTTP请求中的Path。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">protocol</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">HTTP的协议版本。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">request_id</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">网关会为每次请求产生一个ID，并放在Header的x-request-id中，后端可以根据这个字段记录并进行排查。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">requested_server_name</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">SSL连接时使用的Server Name。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">response_code</td>\n<td style=\"text-align:left\">long</td>\n<td style=\"text-align:left\">HTTP响应的状态码。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">response_flags</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">响应失败的原因。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">route_name</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">路由名。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">start_time</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">请求开始时间。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">trace_id</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">Trace ID。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">upstream_cluster</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">上游集群。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">upstream_host</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">上游IP。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">upstream_local_address</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">本地连接上游的地址。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">upstream_service_time</td>\n<td style=\"text-align:left\">long</td>\n<td style=\"text-align:left\">最后一次调用上游服务的时间。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">upstream_transport_failure_reason</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">上游链接失败的原因。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">user_agent</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">HTTP Header中的UserAgent。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">x_forwarded_for</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">HTTP Header中的x-forwarded-for，通常用来表示HTTP请求端真实IP。</td>\n</tr>\n</tbody>\n</table>\n",
  "link": "/zh-cn/docs/ops/log.html",
  "meta": {
    "title": "日志说明",
    "keywords": "higress,log",
    "description": "Higress 日志说明."
  }
}