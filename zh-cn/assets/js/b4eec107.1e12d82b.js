"use strict";(self.webpackChunkhigress_website=self.webpackChunkhigress_website||[]).push([[6376],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>h});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},m=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),c=p(t),d=r,h=c["".concat(l,".").concat(d)]||c[d]||k[d]||s;return t?a.createElement(h,i(i({ref:n},m),{},{components:t})):a.createElement(h,i({ref:n},m))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,i=new Array(s);i[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[c]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<s;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},2747:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>k,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const s={title:"\u901a\u8fc7Ingress Annotation\u5b9e\u73b0\u9ad8\u9636\u6d41\u91cf\u6cbb\u7406",keywords:["Ingress Annotation"],description:"\u5728Higress\u4e0a\u4f7f\u7528Ingress\u5e76\u501f\u52a9Annotation\u5b9e\u73b0\u9ad8\u9636\u6d41\u91cf\u6cbb\u7406\u3002"},i=void 0,o={unversionedId:"user/annotation-use-case",id:"user/annotation-use-case",title:"\u901a\u8fc7Ingress Annotation\u5b9e\u73b0\u9ad8\u9636\u6d41\u91cf\u6cbb\u7406",description:"\u5728Higress\u4e0a\u4f7f\u7528Ingress\u5e76\u501f\u52a9Annotation\u5b9e\u73b0\u9ad8\u9636\u6d41\u91cf\u6cbb\u7406\u3002",source:"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/user/annotation-use-case.md",sourceDirName:"user",slug:"/user/annotation-use-case",permalink:"/zh-cn/docs/user/annotation-use-case",draft:!1,editUrl:"https://github.com/higress-group/higress-group.github.io/blob/main/i18n/zh-cn/docusaurus-plugin-content-docs/current/user/annotation-use-case.md",tags:[],version:"current",frontMatter:{title:"\u901a\u8fc7Ingress Annotation\u5b9e\u73b0\u9ad8\u9636\u6d41\u91cf\u6cbb\u7406",keywords:["Ingress Annotation"],description:"\u5728Higress\u4e0a\u4f7f\u7528Ingress\u5e76\u501f\u52a9Annotation\u5b9e\u73b0\u9ad8\u9636\u6d41\u91cf\u6cbb\u7406\u3002"},sidebar:"docs",previous:{title:"Ingress Annotation \u914d\u7f6e\u8bf4\u660e",permalink:"/zh-cn/docs/user/annotation"},next:{title:"\u8fd0\u7ef4\u53c2\u6570\u914d\u7f6e\u8bf4\u660e",permalink:"/zh-cn/docs/user/configurations"}},l={},p=[{value:"\u524d\u63d0\u6761\u4ef6",id:"\u524d\u63d0\u6761\u4ef6",level:2},{value:"\u7070\u5ea6\u53d1\u5e03",id:"\u7070\u5ea6\u53d1\u5e03",level:2},{value:"\u57fa\u4e8eHeader\u7070\u5ea6\u53d1\u5e03",id:"\u57fa\u4e8eheader\u7070\u5ea6\u53d1\u5e03",level:3},{value:"\u57fa\u4e8eCookie\u7070\u5ea6\u53d1\u5e03",id:"\u57fa\u4e8ecookie\u7070\u5ea6\u53d1\u5e03",level:3},{value:"\u57fa\u4e8e\u6743\u91cd\u7070\u5ea6\u53d1\u5e03",id:"\u57fa\u4e8e\u6743\u91cd\u7070\u5ea6\u53d1\u5e03",level:3},{value:"\u8de8\u57df",id:"\u8de8\u57df",level:2},{value:"Rewrite\u91cd\u5199Path\u548cHost",id:"rewrite\u91cd\u5199path\u548chost",level:2},{value:"Rewrite\u91cd\u5199Path",id:"rewrite\u91cd\u5199path",level:3},{value:"Rewrite\u91cd\u5199Host",id:"rewrite\u91cd\u5199host",level:3},{value:"\u91cd\u5b9a\u5411",id:"\u91cd\u5b9a\u5411",level:2},{value:"\u914d\u7f6eHTTP\u91cd\u5b9a\u5411\u81f3HTTPS",id:"\u914d\u7f6ehttp\u91cd\u5b9a\u5411\u81f3https",level:3},{value:"\u6c38\u4e45\u91cd\u5b9a\u5411",id:"\u6c38\u4e45\u91cd\u5b9a\u5411",level:3},{value:"\u4e34\u65f6\u91cd\u5b9a\u5411",id:"\u4e34\u65f6\u91cd\u5b9a\u5411",level:3},{value:"Header\u63a7\u5236",id:"header\u63a7\u5236",level:2},{value:"\u8bf7\u6c42Header\u63a7\u5236",id:"\u8bf7\u6c42header\u63a7\u5236",level:3},{value:"\u54cd\u5e94Header\u63a7\u5236",id:"\u54cd\u5e94header\u63a7\u5236",level:3},{value:"\u91cd\u8bd5",id:"\u91cd\u8bd5",level:2},{value:"\u8d85\u65f6",id:"\u8d85\u65f6",level:2},{value:"\u5355\u673a\u9650\u6d41",id:"\u5355\u673a\u9650\u6d41",level:2},{value:"\u914d\u7f6e\u540e\u7aef\u670d\u52a1\u534f\u8bae\uff1aHTTPS\u6216GRPC",id:"\u914d\u7f6e\u540e\u7aef\u670d\u52a1\u534f\u8baehttps\u6216grpc",level:2},{value:"\u914d\u7f6e\u540e\u7aef\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5",id:"\u914d\u7f6e\u540e\u7aef\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5",level:2},{value:"\u666e\u901a\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5",id:"\u666e\u901a\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5",level:3},{value:"\u57fa\u4e8e\u4e00\u81f4\u6027Hash\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5",id:"\u57fa\u4e8e\u4e00\u81f4\u6027hash\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5",level:3},{value:"Cookie\u4eb2\u548c\u6027 \uff08\u4f1a\u8bdd\u4fdd\u6301\uff09",id:"cookie\u4eb2\u548c\u6027-\u4f1a\u8bdd\u4fdd\u6301",level:2},{value:"\u7f51\u5173\u4e0e\u540e\u7aef\u670d\u52a1\u53cc\u5411\u8ba4\u8bc1\uff08MTLS)",id:"\u7f51\u5173\u4e0e\u540e\u7aef\u670d\u52a1\u53cc\u5411\u8ba4\u8bc1mtls",level:2}],m={toc:p},c="wrapper";function k(e){let{components:n,...t}=e;return(0,r.kt)(c,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u672c\u7bc7\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u5728Higress\u4e0a\u4f7f\u7528Ingress\u5e76\u501f\u52a9Annotation\u5b9e\u73b0\u9ad8\u9636\u6d41\u91cf\u6cbb\u7406\u3002"),(0,r.kt)("h2",{id:"\u524d\u63d0\u6761\u4ef6"},"\u524d\u63d0\u6761\u4ef6"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/zh-cn/docs/user/quickstart"},"\u5b89\u88c5Higress")),(0,r.kt)("li",{parentName:"ul"},"\u5df2\u62e5\u6709\u4e00\u4e2aKubernetes\u96c6\u7fa4\uff0c\u4e14\u914d\u7f6e\u4e86kubectl\u547d\u4ee4\u884c\u5de5\u5177")),(0,r.kt)("h2",{id:"\u7070\u5ea6\u53d1\u5e03"},"\u7070\u5ea6\u53d1\u5e03"),(0,r.kt)("p",null,"Higress\u63d0\u4f9b\u590d\u6742\u7684\u8def\u7531\u5904\u7406\u80fd\u529b\uff0c\u652f\u6301\u57fa\u4e8eHeader\u3001Cookie\u4ee5\u53ca\u6743\u91cd\u7684\u7070\u5ea6\u53d1\u5e03\u529f\u80fd\u3002\u7070\u5ea6\u53d1\u5e03\u529f\u80fd\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u6ce8\u89e3\u6765\u5b9e\u73b0\uff0c\u4e3a\u4e86\u542f\u7528\u7070\u5ea6\u53d1\u5e03\u529f\u80fd\uff0c\u9700\u8981\u8bbe\u7f6e\u6ce8\u89e3",(0,r.kt)("inlineCode",{parentName:"p"},'higress.io/canary: "true"'),"\u3002\u901a\u8fc7\u4e0d\u540c\u6ce8\u89e3\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u7684\u7070\u5ea6\u53d1\u5e03\u529f\u80fd\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8bf4\u660e\uff1a\u5f53\u591a\u79cd\u65b9\u5f0f\u540c\u65f6\u914d\u7f6e\u65f6\uff0c\u7070\u5ea6\u65b9\u5f0f\u9009\u62e9\u4f18\u5148\u7ea7\u4e3a\uff1a\u57fa\u4e8eHeader > \u57fa\u4e8eCookie > \u57fa\u4e8e\u6743\u91cd\uff08\u4ece\u9ad8\u5230\u4f4e\uff09\u3002")),(0,r.kt)("h3",{id:"\u57fa\u4e8eheader\u7070\u5ea6\u53d1\u5e03"},"\u57fa\u4e8eHeader\u7070\u5ea6\u53d1\u5e03"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u53ea\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"li"},"higress.io/canary-by-header"),"\uff1a\u57fa\u4e8eRequest Header\u7684\u540d\u79f0\u8fdb\u884c\u6d41\u91cf\u5207\u5206\u3002\u5f53\u8bf7\u6c42\u5305\u542b\u8be5Header\u5e76\u5176\u503c\u4e3aalways\u65f6\uff0c\u8bf7\u6c42\u6d41\u91cf\u4f1a\u88ab\u5206\u914d\u5230\u7070\u5ea6\u670d\u52a1\u5165\u53e3\uff1b\u5176\u4ed6\u60c5\u51b5\u65f6\uff0c\u8bf7\u6c42\u6d41\u91cf\u4e0d\u4f1a\u5206\u914d\u5230\u7070\u5ea6\u670d\u52a1\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u540c\u65f6\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"li"},"higress.io/canary-by-header"),"\u548c",(0,r.kt)("inlineCode",{parentName:"li"},"higress.io/canary-by-header-value"),"\uff1a\u57fa\u4e8eRequest Header\u7684\u540d\u79f0\u548c\u503c\u8fdb\u884c\u6d41\u91cf\u5207\u5206\u3002\u5f53\u8bf7\u6c42\u4e2d\u7684header\u7684\u540d\u79f0\u548cheader\u7684\u503c\u4e0e\u8be5\u914d\u7f6e\u5339\u914d\u65f6\uff0c\u8bf7\u6c42\u6d41\u91cf\u4f1a\u88ab\u5206\u914d\u5230\u7070\u5ea6\u670d\u52a1\uff1b\u5176\u4ed6\u60c5\u51b5\u65f6\uff0c\u8bf7\u6c42\u6d41\u91cf\u4e0d\u4f1a\u5206\u914d\u5230\u7070\u5ea6\u670d\u52a1\u3002",(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Higress\u7070\u5ea6\u53d1\u5e03\u65f6\u652f\u6301\u591a\u4e2a\u7248\u672c\u670d\u52a1\uff08\u65e0\u4e0a\u9650\uff09\u3002")))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u8bf7\u6c42Header\u4e3a",(0,r.kt)("inlineCode",{parentName:"li"},"higress\uff1aalways"),"\u65f6\u5c06\u8bbf\u95ee\u7070\u5ea6\u670d\u52a1demo-service-canary\uff1b\u5176\u4ed6\u60c5\u51b5\u5c06\u8bbf\u95ee\u6b63\u5f0f\u670d\u52a1demo-service\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/canary: "true"\n    higress.io/canary-by-header: "higress"\n  name: demo-canary\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service-canary\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact   \n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u8bf7\u6c42Header\u4e3a",(0,r.kt)("inlineCode",{parentName:"li"},"higress\uff1av1"),"\u65f6\u5c06\u8bbf\u95ee\u7070\u5ea6\u670d\u52a1demo-service-canary-v1\uff1b\u8bf7\u6c42Header\u4e3a",(0,r.kt)("inlineCode",{parentName:"li"},"higress\uff1av2"),"\u65f6\u5c06\u8bbf\u95ee\u7070\u5ea6\u670d\u52a1demo-service-canary-v2\uff1b\u5176\u4ed6\u60c5\u51b5\u5c06\u8bbf\u95ee\u6b63\u5f0f\u670d\u52a1demo-service\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/canary: "true"\n    higress.io/canary-by-header: "higress"\n    higress.io/canary-by-header-value: "v1"\n  name: demo-canary-v1\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service-canary-v1\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/canary: "true"\n    higress.io/canary-by-header: "higress"\n    higress.io/canary-by-header-value: "v2"\n  name: demo-canary-v2\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service-canary-v2\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n')),(0,r.kt)("h3",{id:"\u57fa\u4e8ecookie\u7070\u5ea6\u53d1\u5e03"},"\u57fa\u4e8eCookie\u7070\u5ea6\u53d1\u5e03"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/canary-by-cookie\uff1a\u57fa\u4e8eCookie\u7684Key\u8fdb\u884c\u6d41\u91cf\u5207\u5206\u3002\u5f53\u8bf7\u6c42\u7684Cookie\u4e2d\u542b\u6709\u8be5Key\u4e14\u5176\u503c\u4e3aalways\u65f6\uff0c\u8bf7\u6c42\u6d41\u91cf\u5c06\u88ab\u5206\u914d\u5230\u7070\u5ea6\u670d\u52a1\uff1b\u5176\u4ed6\u60c5\u51b5\u65f6\uff0c\u8bf7\u6c42\u6d41\u91cf\u5c06\u4e0d\u4f1a\u5206\u914d\u5230\u7070\u5ea6\u670d\u52a1\u3002",(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"\u8bf4\u660e\uff1a\u57fa\u4e8eCookie\u7684\u7070\u5ea6\u53d1\u5e03\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49\u8bbe\u7f6eKey\u5bf9\u5e94\u7684\u503c\uff0c\u53ea\u80fd\u662falways\u3002")))),(0,r.kt)("p",null,"\u8bf7\u6c42\u7684Cookie\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"demo=always"),"\u65f6\u5c06\u8bbf\u95ee\u7070\u5ea6\u670d\u52a1demo-service-canary\uff1b\u5176\u4ed6\u60c5\u51b5\u5c06\u8bbf\u95ee\u6b63\u5f0f\u670d\u52a1demo-service\u3002\u914d\u7f6e\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/canary: "true"\n    higress.io/canary-by-cookie: "demo"\n  name: demo-canary\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service-canary\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n')),(0,r.kt)("h3",{id:"\u57fa\u4e8e\u6743\u91cd\u7070\u5ea6\u53d1\u5e03"},"\u57fa\u4e8e\u6743\u91cd\u7070\u5ea6\u53d1\u5e03"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/canary-weight\uff1a\u8bbe\u7f6e\u8bf7\u6c42\u5230\u6307\u5b9a\u670d\u52a1\u7684\u767e\u5206\u6bd4\uff08\u503c\u4e3a0~100\u7684\u6574\u6570\uff09"),(0,r.kt)("li",{parentName:"ul"},"higress.io/canary-weight-total\uff1a\u8bbe\u7f6e\u6743\u91cd\u603b\u548c\uff0c\u9ed8\u8ba4\u4e3a100")),(0,r.kt)("p",null,"\u914d\u7f6e\u7070\u5ea6\u670d\u52a1demo-service-canary-v1\u7684\u6743\u91cd\u4e3a30%\uff0c\u914d\u7f6e\u7070\u5ea6\u670d\u52a1demo-service-canary-v2\u7684\u6743\u91cd\u4e3a20%\uff0c\u914d\u7f6e\u6b63\u5f0f\u670d\u52a1demo-service\u7684\u6743\u91cd\u4e3a50%\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/canary: "true"\n    higress.io/canary-weight: "30"\n  name: demo-canary-v1\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service-canary-v1\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/canary: "true"\n    higress.io/canary-weight: "20"\n  name: demo-canary-v2\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service-canary-v2\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"\u8de8\u57df"},"\u8de8\u57df"),(0,r.kt)("p",null,"\u8de8\u57df\u8d44\u6e90\u5171\u4eabCORS\uff08Cross-Origin Resource Sharing\uff09\u662f\u6307\u5141\u8bb8Web\u5e94\u7528\u670d\u52a1\u5668\u8fdb\u884c\u8de8\u57df\u8bbf\u95ee\u63a7\u5236\uff0c\u4ece\u800c\u5b9e\u73b0\u8de8\u57df\u6570\u636e\u5b89\u5168\u4f20\u8f93\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'higress.io/enable-cors\uff1a"true" or "false"\u3002\u5f00\u542f\u6216\u5173\u95ed\u8de8\u57df\u3002'),(0,r.kt)("li",{parentName:"ul"},"higress.io/cors-allow-origin\uff1a\u5141\u8bb8\u7684\u7b2c\u4e09\u65b9\u7ad9\u70b9\uff0c\u652f\u6301\u6cdb\u57df\u540d\uff0c\u9017\u53f7\u5206\u9694\uff1b\u652f\u6301\u901a\u914d\u7b26",(0,r.kt)("em",{parentName:"li"},"\u3002\u9ed8\u8ba4\u503c\u4e3a"),"\uff0c\u5373\u5141\u8bb8\u6240\u6709\u7b2c\u4e09\u65b9\u7ad9\u70b9\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/cors-allow-methods\uff1a\u5141\u8bb8\u7684\u8bf7\u6c42\u65b9\u6cd5\uff0c\u5982GET\u3001POST\uff0c\u9017\u53f7\u5206\u9694\uff1b\u652f\u6301\u901a\u914d\u7b26*\u3002\u9ed8\u8ba4\u503c\u4e3aGET, PUT, POST, DELETE, PATCH, OPTIONS\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/cors-allow-headers\uff1a\u5141\u8bb8\u7684\u8bf7\u6c42\u5934\u90e8\uff0c\u9017\u53f7\u5206\u9694\uff1b\u652f\u6301\u901a\u914d\u7b26*\u3002\u9ed8\u8ba4\u503c\u4e3aDNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/cors-expose-headers\uff1a\u5141\u8bb8\u7684\u54cd\u5e94\u5934\u90e8\uff0c\u9017\u53f7\u5206\u9694\u3002"),(0,r.kt)("li",{parentName:"ul"},'higress.io/cors-allow-credentials\uff1a"true" or "false"\u3002\u662f\u5426\u5141\u8bb8\u643a\u5e26\u51ed\u8bc1\u4fe1\u606f\u3002\u9ed8\u8ba4\u5141\u8bb8\u3002'),(0,r.kt)("li",{parentName:"ul"},"higress.io/cors-max-age\uff1a\u9884\u68c0\u7ed3\u679c\u7684\u6700\u5927\u7f13\u5b58\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\uff1b\u9ed8\u8ba4\u503c\u4e3a1728000\u3002")),(0,r.kt)("p",null,"\u8de8\u57df\u8bf7\u6c42\u88ab\u9650\u5236\u4e3a\u53ea\u80fd\u6765\u81eaexample.com\u57df\u7684\u8bf7\u6c42\uff0c\u5e76\u4e14HTTP\u65b9\u6cd5\u53ea\u80fd\u662fGET\u548cPOST\uff0c\u5141\u8bb8\u7684\u8bf7\u6c42\u5934\u90e8\u4e3aX-Foo-Bar\uff0c\u4e0d\u5141\u8bb8\u643a\u5e26\u51ed\u8bc1\u4fe1\u606f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/enable-cors: "true"\n    higress.io/cors-allow-origin: "example.com"\n    higress.io/cors-allow-methods: "GET,POST"\n    higress.io/cors-allow-headers: "X-Foo-Bar"\n    higress.io/cors-allow-credentials: "false"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"rewrite\u91cd\u5199path\u548chost"},"Rewrite\u91cd\u5199Path\u548cHost"),(0,r.kt)("p",null,"\u5728\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u76ee\u6807\u540e\u7aef\u670d\u52a1\u4e4b\u524d\uff0c\u91cd\u5199\u53ef\u4ee5\u4fee\u6539\u539f\u59cb\u8bf7\u6c42\u7684\u8def\u5f84\uff08Path\uff09\u548c\u4e3b\u673a\u57df\uff08Host)\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/rewrite-target\uff1a\u91cd\u5199Path\uff0c\u652f\u6301\u6355\u83b7\u7ec4\uff08Capture Group)\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/upstream-vhost\uff1a\u91cd\u5199Host\u3002")),(0,r.kt)("h3",{id:"rewrite\u91cd\u5199path"},"Rewrite\u91cd\u5199Path"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5c06\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"li"},"example.com/test"),"\u5728\u8f6c\u53d1\u81f3\u540e\u7aef\u670d\u52a1\u4e4b\u524d\uff0c\u91cd\u5199\u4e3a",(0,r.kt)("inlineCode",{parentName:"li"},"example.com/dev"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/rewrite-target: "/dev"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5c06\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"li"},"example.com/v1/app"),"\u5728\u8f6c\u53d1\u81f3\u540e\u7aef\u670d\u52a1\u4e4b\u524d\uff0c\u53bb\u6389Path\u524d\u7f00/v1")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/rewrite-target: "/$2"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /v1(/|$)(.*)\n            pathType: ImplementationSpecific\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u5c06\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"li"},"example.com/v1/app"),"\u5728\u8f6c\u53d1\u81f3\u540e\u7aef\u670d\u52a1\u4e4b\u524d\uff0c\u5c06Path\u524d\u7f00/v1\u66f4\u6539\u4e3a/v2")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/rewrite-target: "/v2/$2"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /v1(/|$)(.*)\n            pathType: ImplementationSpecific\n')),(0,r.kt)("h3",{id:"rewrite\u91cd\u5199host"},"Rewrite\u91cd\u5199Host"),(0,r.kt)("p",null,"\u5c06\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"p"},"example.com/test"),"\u5728\u8f6c\u53d1\u81f3\u540e\u7aef\u670d\u52a1\u4e4b\u524d\uff0c\u91cd\u5199\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"test.com/test")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/upstream-vhost: "test.com"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"\u91cd\u5b9a\u5411"},"\u91cd\u5b9a\u5411"),(0,r.kt)("p",null,"\u901a\u8fc7\u91cd\u5b9a\u5411\u53ef\u4ee5\u5c06\u539f\u59cb\u5ba2\u6237\u7aef\u8bf7\u6c42\u66f4\u6539\u4e3a\u76ee\u6807\u8bf7\u6c42\u3002"),(0,r.kt)("h3",{id:"\u914d\u7f6ehttp\u91cd\u5b9a\u5411\u81f3https"},"\u914d\u7f6eHTTP\u91cd\u5b9a\u5411\u81f3HTTPS"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/ssl-redirect\uff1aHTTP\u91cd\u5b9a\u5411\u5230HTTPS"),(0,r.kt)("li",{parentName:"ul"},"higress.io/force-ssl-redirect: HTTP\u91cd\u5b9a\u5411\u5230HTTPS",(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"\u8bf4\u660e\uff1aHigress\u5bf9\u4e8e\u4ee5\u4e0a\u4e24\u4e2a\u6ce8\u89e3\u4e0d\u533a\u5206\u5bf9\u5f85\uff0c\u90fd\u662f\u5f3a\u5236\u5c06HTTP\u91cd\u5b9a\u5411\u5230HTTPS\u3002")))),(0,r.kt)("p",null,"\u5c06\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"p"},"http://example.com/test"),"\u91cd\u5b9a\u5411\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"https://example.com/test"),"\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/ssl-redirect: "true"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h3",{id:"\u6c38\u4e45\u91cd\u5b9a\u5411"},"\u6c38\u4e45\u91cd\u5b9a\u5411"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/permanent-redirect\uff1a\u6c38\u4e45\u91cd\u5b9a\u5411\u7684\u76ee\u6807url\uff0c\u5fc5\u987b\u5305\u542bscheme\uff08http or https)\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/permanent-redirect-code\uff1a\u6c38\u4e45\u91cd\u5b9a\u5411\u7684HTTP\u72b6\u6001\u7801\uff0c\u9ed8\u8ba4\u4e3a301\u3002")),(0,r.kt)("p",null,"\u5c06\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"p"},"http://example.com/test"),"\u6c38\u4e45\u91cd\u5b9a\u5411\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"http://example.com/app"),"\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/permanent-redirect: "http://example.com/app"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h3",{id:"\u4e34\u65f6\u91cd\u5b9a\u5411"},"\u4e34\u65f6\u91cd\u5b9a\u5411"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/temporal-redirect\uff1a\u4e34\u65f6\u91cd\u5b9a\u5411\u7684\u76ee\u6807url\uff0c\u5fc5\u987b\u5305\u542bscheme\uff08http or https)\u3002")),(0,r.kt)("p",null,"\u5c06\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"p"},"http://example.com/test"),"\u4e34\u65f6\u91cd\u5b9a\u5411\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"http://example.com/app"),"\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/temporal-redirect: "http://example.com/app"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"header\u63a7\u5236"},"Header\u63a7\u5236"),(0,r.kt)("p",null,"\u901a\u8fc7Header\u63a7\u5236\uff0c\u60a8\u53ef\u4ee5\u5728\u8f6c\u53d1\u8bf7\u6c42\u5230\u540e\u7aef\u670d\u52a1\u4e4b\u524d\u5bf9\u8bf7\u6c42Header\u8fdb\u884c\u589e\u5220\u6539\uff0c\u5728\u6536\u5230\u54cd\u5e94\u8f6c\u53d1\u7ed9\u5ba2\u6237\u7aef\u65f6\u5bf9\u54cd\u5e94Header\u8fdb\u884c\u589e\u5220\u6539\u3002"),(0,r.kt)("h3",{id:"\u8bf7\u6c42header\u63a7\u5236"},"\u8bf7\u6c42Header\u63a7\u5236"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/request-header-control-add\uff1a\u8bf7\u6c42\u5728\u8f6c\u53d1\u7ed9\u540e\u7aef\u670d\u52a1\u65f6\uff0c\u6dfb\u52a0\u6307\u5b9aHeader\u3002\u82e5\u8be5Header\u5b58\u5728\uff0c\u5219\u5176\u503c\u62fc\u63a5\u5728\u539f\u6709\u503c\u540e\u9762\u3002\u8bed\u6cd5\u5982\u4e0b\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5355\u4e2aHeader\uff1aKey Value"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u4e2aHeader\uff1a\u4f7f\u7528yaml\u7279\u6b8a\u7b26\u53f7 |\uff0c\u6bcf\u5bf9Key Value\u5355\u72ec\u5904\u4e8e\u4e00\u884c"))),(0,r.kt)("li",{parentName:"ul"},"higress.io/request-header-control-update\uff1a\u8bf7\u6c42\u5728\u8f6c\u53d1\u7ed9\u540e\u7aef\u670d\u52a1\u65f6\uff0c\u4fee\u6539\u6307\u5b9aHeader\u3002\u82e5\u8be5header\u5b58\u5728\uff0c\u5219\u5176\u503c\u8986\u76d6\u539f\u6709\u503c\u3002\u8bed\u6cd5\u5982\u4e0b\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5355\u4e2aHeader\uff1aKey Value"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u4e2aHeader\uff1a\u4f7f\u7528yaml\u7279\u6b8a\u7b26\u53f7 |\uff0c\u6bcf\u5bf9Key Value\u5355\u72ec\u5904\u4e8e\u4e00\u884c"))),(0,r.kt)("li",{parentName:"ul"},"higress.io/request-header-control-remove\uff1a\u8bf7\u6c42\u5728\u8f6c\u53d1\u7ed9\u540e\u7aef\u670d\u52a1\u65f6\uff0c\u5220\u9664\u6307\u5b9aHeader\u3002\u8bed\u6cd5\u5982\u4e0b\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5355\u4e2aHeader\uff1aKey"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u4e2aHeader\uff1a\u9017\u53f7\u5206\u9694")))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5bf9\u4e8e\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"li"},"example.com/test"),"\u6dfb\u52a0\u4e24\u4e2aHeader\uff0c",(0,r.kt)("inlineCode",{parentName:"li"},"foo: bar"),"\u548c",(0,r.kt)("inlineCode",{parentName:"li"},"test: true"),"\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/request-header-control-add: |\n      foo bar\n      test true\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Header\u63a7\u5236\u53ef\u4ee5\u7ed3\u5408\u7070\u5ea6\u53d1\u5e03\uff0c\u5bf9\u7070\u5ea6\u6d41\u91cf\u8fdb\u884c\u67d3\u8272\u3002\u8bf7\u6c42Header\u4e3a",(0,r.kt)("inlineCode",{parentName:"li"},"higress\uff1av1"),"\u65f6\u5c06\u8bbf\u95ee\u7070\u5ea6\u670d\u52a1demo-service-canary-v1\uff0c\u5e76\u6dfb\u52a0Header\uff0c",(0,r.kt)("inlineCode",{parentName:"li"},"stage: gray"),"\uff1b\u5176\u4ed6\u60c5\u51b5\u5c06\u8bbf\u95ee\u6b63\u5f0f\u670d\u52a1demo-service\uff0c\u5e76\u6dfb\u52a0Header\uff0c",(0,r.kt)("inlineCode",{parentName:"li"},"stage: production"),"\u3002\u914d\u7f6e\u5982\u4e0b\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/canary: "true"\n    higress.io/canary-by-header: "higress"\n    higress.io/canary-by-header-value: "v1"\n    higress.io/request-header-control-add: "stage gray"\n  name: demo-canary-v1\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service-canary-v1\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/request-header-control-add: "stage production"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /hello\n            pathType: Exact\n')),(0,r.kt)("h3",{id:"\u54cd\u5e94header\u63a7\u5236"},"\u54cd\u5e94Header\u63a7\u5236"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/response-header-control-add\uff1a\u8bf7\u6c42\u5728\u6536\u5230\u540e\u7aef\u670d\u52a1\u54cd\u5e94\u4e4b\u540e\u5e76\u4e14\u8f6c\u53d1\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u4e4b\u524d\uff0c\u6dfb\u52a0\u6307\u5b9aHeader\u3002\u82e5\u8be5Header\u5b58\u5728\uff0c\u5219\u5176\u503c\u62fc\u63a5\u5728\u539f\u6709\u503c\u540e\u9762\u3002\u8bed\u6cd5\u5982\u4e0b\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5355\u4e2aHeader\uff1aKey Value"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u4e2aHeader\uff1a\u4f7f\u7528yaml\u7279\u6b8a\u7b26\u53f7 |\uff0c\u6bcf\u5bf9Key Value\u5355\u72ec\u5904\u4e8e\u4e00\u884c"))),(0,r.kt)("li",{parentName:"ul"},"higress.io/response-header-control-update\uff1a\u8bf7\u6c42\u5728\u6536\u5230\u540e\u7aef\u670d\u52a1\u54cd\u5e94\u4e4b\u540e\u5e76\u4e14\u8f6c\u53d1\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u4e4b\u524d\uff0c\u4fee\u6539\u6307\u5b9aHeader\u3002\u82e5\u8be5header\u5b58\u5728\uff0c\u5219\u5176\u503c\u8986\u76d6\u539f\u6709\u503c\u3002\u8bed\u6cd5\u5982\u4e0b\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5355\u4e2aHeader\uff1aKey Value"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u4e2aHeader\uff1a\u4f7f\u7528yaml\u7279\u6b8a\u7b26\u53f7 |\uff0c\u6bcf\u5bf9Key Value\u5355\u72ec\u5904\u4e8e\u4e00\u884c"))),(0,r.kt)("li",{parentName:"ul"},"higress.io/response-header-control-remove\uff1a\u8bf7\u6c42\u5728\u6536\u5230\u540e\u7aef\u670d\u52a1\u54cd\u5e94\u4e4b\u540e\u5e76\u4e14\u8f6c\u53d1\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u4e4b\u524d\uff0c\u5220\u9664\u6307\u5b9aHeader\u3002\u8bed\u6cd5\u5982\u4e0b\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5355\u4e2aHeader\uff1aKey"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u4e2aHeader\uff1a\u9017\u53f7\u5206\u9694")))),(0,r.kt)("p",null,"\u5bf9\u4e8e\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"p"},"example.com/test"),"\u7684\u54cd\u5e94\u5220\u9664",(0,r.kt)("inlineCode",{parentName:"p"},"Header\uff1areq-cost-time"),"\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/response-header-control-remove: "req-cost-time"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"\u91cd\u8bd5"},"\u91cd\u8bd5"),(0,r.kt)("p",null,"Higress\u63d0\u4f9b\u8def\u7531\u7ea7\u522b\u7684\u91cd\u8bd5\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u4e3a\u51fa\u9519\u7684\u8bf7\u6c42\u8c03\u7528\u81ea\u52a8\u8fdb\u884c\u91cd\u8bd5\u3002\u60a8\u53ef\u4ee5\u6309\u9700\u8bbe\u7f6e\u91cd\u8bd5\u6761\u4ef6\uff0c\u4f8b\u5982\u5efa\u7acb\u8fde\u63a5\u5931\u8d25\uff0c\u6216\u8005\u540e\u7aef\u670d\u52a1\u4e0d\u53ef\u7528\u4ee5\u53ca\u5bf9\u6307\u5b9aHTTP\u72b6\u6001\u7801\u7684\u54cd\u5e94\u7b49\u8fdb\u884c\u8bf7\u6c42\u91cd\u8bd5\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/proxy-next-upstream-tries\uff1a\u8bf7\u6c42\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u3002\u9ed8\u8ba43\u6b21\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/proxy-next-upstream-timeout\uff1a\u8bf7\u6c42\u91cd\u8bd5\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\u3002\u9ed8\u8ba4\u672a\u914d\u7f6e\u8d85\u65f6\u65f6\u95f4\u3002"),(0,r.kt)("li",{parentName:"ul"},'higress.io/proxy-next-upstream\uff1a\u8bf7\u6c42\u91cd\u8bd5\u6761\u4ef6\uff0c\u9017\u53f7\u5206\u9694\uff1b\u9ed8\u8ba4\u503c\u4e3a"error,timeout"\u3002\u5408\u6cd5\u503c\u5982\u4e0b\uff1a',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"error\uff1a\u5efa\u7acb\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u6c42\u51fa\u95195xx\u3002"),(0,r.kt)("li",{parentName:"ul"},"timeout\uff1a\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\uff0c\u8bf7\u6c42\u51fa\u95195xx\u3002"),(0,r.kt)("li",{parentName:"ul"},"invalid_header\uff1a\u8bf7\u6c42\u51fa\u95195xx\u3002"),(0,r.kt)("li",{parentName:"ul"},"http_xxx\uff1a\u9488\u5bf9\u5177\u4f53\u54cd\u5e94\u72b6\u6001\u7801\u7684\u60c5\u51b5\u8fdb\u884c\u91cd\u8bd5\u3002\u4f8b\u5982http_502\uff0chttp_403\u3002"),(0,r.kt)("li",{parentName:"ul"},"non_idempotent\uff1a\u5bf9\u4e8e\u975e\u5e42\u7b49\u8bf7\u6c42\u51fa\u9519\u65f6\u8fdb\u884c\u91cd\u8bd5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cHigress\u9488\u5bf9\u975e\u5e42\u7b49POST\u3001PATCH\u8bf7\u6c42\u51fa\u9519\u65f6\u4e0d\u4f1a\u8fdb\u884c\u91cd\u8bd5\uff0c\u914d\u7f6enon_idempotent\u53ef\u4ee5\u5f00\u542f\u91cd\u8bd5\u3002"),(0,r.kt)("li",{parentName:"ul"},"off\uff1a\u5173\u95ed\u91cd\u8bd5\u3002")))),(0,r.kt)("p",null,"\u8bbe\u7f6e",(0,r.kt)("inlineCode",{parentName:"p"},"example/test"),"\u8bf7\u6c42\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u4e3a2\uff0c\u91cd\u8bd5\u8d85\u65f6\u65f6\u95f4\u4e3a5s\uff0c\u53ea\u6709\u5728\u54cd\u5e94\u72b6\u6001\u7801\u4e3a502\u624d\u91cd\u8bd5\uff0c\u5e76\u4e14\u5f00\u542f\u975e\u5e42\u7b49\u91cd\u8bd5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/proxy-next-upstream-tries: "2"\n    higress.io/proxy-next-upstream-timeout: "5"\n    higress.io/proxy-next-upstream: "http_502,non_idempotent"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"\u8d85\u65f6"},"\u8d85\u65f6"),(0,r.kt)("p",null,"Higress\u63d0\u4f9b\u8def\u7531\u7ea7\u522b\u7684\u8d85\u65f6\u8bbe\u7f6e\uff0c\u4e0enginx ingress\u4e0d\u540c\uff0c\u6ca1\u6709\u533a\u5206\u8fde\u63a5/\u8bfb\u5199\u8d85\u65f6\uff0c\u800c\u662f\u9762\u5411\u7684\u63a5\u53e3\u5904\u7406\u603b\u5ef6\u65f6\u8fdb\u884c\u914d\u7f6e\uff0c\u5728\u672a\u8fdb\u884c\u914d\u7f6e\u65f6\u9ed8\u8ba4\u4e0d\u9650\u5236\uff0c\u4f8b\u5982\u540e\u7aef\u672a\u8fd4\u56de\u5e94\u7b54\uff0c\u7f51\u5173\u5c06\u65e0\u9650\u7b49\u5f85\u3002"),(0,r.kt)("p",null,"\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u4e3a5s\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/timeout: "5"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"\u5355\u673a\u9650\u6d41"},"\u5355\u673a\u9650\u6d41"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"\u63d0\u793a"),"\nHigress\u5546\u4e1a\u7248\u5177\u5907\u5168\u5c40\u9650\u6d41\u80fd\u529b\uff0c\u8be6\u60c5\u67e5\u770b",(0,r.kt)("a",{parentName:"p",href:"https://help.aliyun.com/zh/mse/user-guide/advanced-usage-of-mse-ingress?spm=a2c4g.11186623.0.0.2e3a3db3eYcspD#862f08d03d4d3"},"\u5546\u4e1a\u7248\u6587\u6863"),"\u4e2d\u5168\u5c40\u9650\u6d41\u4e00\u8282\u7684\u4ecb\u7ecd")),(0,r.kt)("p",null,"\u652f\u6301\u9488\u5bf9\u8def\u7531\u7ea7\u522b\u7684\u5355\u673a\u9650\u6d41\u7b56\u7565\uff0c\u5728\u8bbe\u5b9a\u7684\u65f6\u95f4\u5468\u671f\u5185\uff0c\u9650\u5236\u6bcf\u4e2a\u7f51\u5173\u526f\u672c\u5339\u914d\u5728\u67d0\u4e2a\u8def\u7531\u4e0a\u7684\u8bf7\u6c42\u6570\u91cf\u4e0d\u5927\u4e8e\u9608\u503c\u3002\u8be5\u9650\u6d41\u662f\u9488\u5bf9\u5355\u673a\u7ea7\u522b\uff0c\u5373\u914d\u7f6e\u7684\u9608\u503c\u5728\u6bcf\u4e2a\u7f51\u5173\u5b9e\u4f8b\u8fdb\u884c\u6d41\u63a7\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/route-limit-rpm\uff1a\u8be5Ingress\u5b9a\u4e49\u7684\u8def\u7531\u5728\u6bcf\u4e2a\u7f51\u5173\u5b9e\u4f8b\u4e0a\u6bcf\u5206\u949f\u6700\u5927\u8bf7\u6c42\u6b21\u6570\u3002\u77ac\u65f6\u6700\u5927\u8bf7\u6c42\u6b21\u6570\u4e3a\u8be5\u503c\u4e58\u4ee5limit-burst-multiplier\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/route-limit-rps\uff1a\u8be5Ingress\u5b9a\u4e49\u7684\u8def\u7531\u5728\u6bcf\u4e2a\u7f51\u5173\u5b9e\u4f8b\u4e0a\u6bcf\u79d2\u6700\u5927\u8bf7\u6c42\u6b21\u6570\u3002\u77ac\u65f6\u6700\u5927\u8bf7\u6c42\u6b21\u6570\u4e3a\u8be5\u503c\u4e58\u4ee5limit-burst-multiplier\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/route-limit-burst-multiplier\uff1a\u77ac\u65f6\u6700\u5927\u8bf7\u6c42\u6b21\u6570\u7684\u56e0\u5b50\uff0c\u9ed8\u8ba4\u4e3a5\u3002")),(0,r.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,r.kt)("p",null,"\u9650\u5236example.com/test\u7684\u8bf7\u6c42\u6bcf\u5206\u949f\u6700\u5927\u8bf7\u6c42\u6570\u4e3a100\uff0c\u77ac\u65f6\u8bf7\u6c42\u6570200\u3002\u914d\u7f6e\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/route-limit-rpm: "100"\n    higress.io/route-limit-burst-multiplier: "2"\n  name: demo\nspec:\n  ingressClassName: mse\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("p",null,"\u9650\u5236example.com/test\u7684\u8bf7\u6c42\u6bcf\u79d2\u6700\u5927\u8bf7\u6c42\u6570\u4e3a10\uff0c\u77ac\u65f6\u8bf7\u6c42\u657050\u3002\u914d\u7f6e\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/route-limit-rps: "10"\n    # \u9ed8\u8ba4\u4e3a5\n    # higress.io/route-limit-burst-multiplier: "5"\n  name: demo\nspec:\n  ingressClassName: mse\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"\u914d\u7f6e\u540e\u7aef\u670d\u52a1\u534f\u8baehttps\u6216grpc"},"\u914d\u7f6e\u540e\u7aef\u670d\u52a1\u534f\u8bae\uff1aHTTPS\u6216GRPC"),(0,r.kt)("p",null,"Higress\u9ed8\u8ba4\u4f7f\u7528HTTP\u534f\u8bae\u8f6c\u53d1\u8bf7\u6c42\u5230\u540e\u7aef\u4e1a\u52a1\u5bb9\u5668\u3002\u5f53\u60a8\u7684\u4e1a\u52a1\u5bb9\u5668\u4e3aHTTPS\u534f\u8bae\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u6ce8\u89e3",(0,r.kt)("inlineCode",{parentName:"p"},'higress.io/backend-protocol: "HTTPS"'),"\uff1b\u5f53\u60a8\u7684\u4e1a\u52a1\u5bb9\u5668\u4e3aGRPC\u670d\u52a1\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u6ce8\u89e3",(0,r.kt)("inlineCode",{parentName:"p"},'higress.io/backend-protocol: "GRPC"'),"\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},'\u8bf4\u660e\uff1a\u76f8\u6bd4Nginx Ingress\u7684\u4f18\u52bf\uff0c\u5982\u679c\u60a8\u7684\u540e\u7aef\u670d\u52a1\u6240\u5c5e\u7684K8s Service\u8d44\u6e90\u4e2d\u5173\u4e8ePort Name\u7684\u5b9a\u4e49\u4e3agrpc\u6216http2\uff0c\u60a8\u65e0\u9700\u914d\u7f6e\u6ce8\u89e3higress.io/backend-protocol: "GRPC"\uff0cHigress\u4f1a\u81ea\u52a8\u4f7f\u7528GRPC\u6216\u8005HTTP2\u3002')),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"li"},"example/test"),"\u8f6c\u53d1\u81f3\u540e\u7aef\u670d\u52a1\u4f7f\u7528HTTPS\u534f\u8bae\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/backend-protocol: "HTTPS"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /\n            pathType: Exact\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u8bf7\u6c42",(0,r.kt)("inlineCode",{parentName:"li"},"example/test"),"\u8f6c\u53d1\u81f3\u540e\u7aef\u670d\u52a1\u4f7f\u7528GRPC\u534f\u8bae\u3002\n\u7b2c\u4e00\u79cd\u505a\u6cd5\uff1a\u901a\u8fc7\u6ce8\u89e3\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/backend-protocol: "GRPC"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("p",null,"\u7b2c\u4e8c\u79cd\u505a\u6cd5\uff1a\u901a\u8fc7Service Port Name"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /order\n            pathType: Exact\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: demo-service\nspec:\n  ports:\n    - name: grpc\n      port: 80\n      protocol: TCP\n  selector:\n    app: demo-service\n")),(0,r.kt)("h2",{id:"\u914d\u7f6e\u540e\u7aef\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"},"\u914d\u7f6e\u540e\u7aef\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"),(0,r.kt)("p",null,"\u8d1f\u8f7d\u5747\u8861\u51b3\u5b9a\u7740\u7f51\u5173\u5728\u8f6c\u53d1\u8bf7\u6c42\u81f3\u540e\u7aef\u670d\u52a1\u65f6\u5982\u4f55\u9009\u62e9\u8282\u70b9\u3002"),(0,r.kt)("h3",{id:"\u666e\u901a\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"},"\u666e\u901a\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/load-balance\uff1a\u540e\u7aef\u670d\u52a1\u7684\u666e\u901a\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u3002\u9ed8\u8ba4\u4e3around_robin\u3002\u5408\u6cd5\u503c\u5982\u4e0b\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"round_robin\uff1a\u57fa\u4e8e\u8f6e\u8be2\u7684\u8d1f\u8f7d\u5747\u8861\u3002"),(0,r.kt)("li",{parentName:"ul"},"least_conn\uff1a\u57fa\u4e8e\u6700\u5c0f\u8bf7\u6c42\u6570\u7684\u8d1f\u8f7d\u5747\u8861\u3002"),(0,r.kt)("li",{parentName:"ul"},"random\uff1a\u57fa\u4e8e\u968f\u673a\u7684\u8d1f\u8f7d\u5747\u8861\u3002")))),(0,r.kt)("p",null,"\u8bbe\u7f6e\u540e\u7aef\u670d\u52a1demo-service\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u4e3aleast_conn\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/load-balance: "least_conn"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /order\n            pathType: Exact\n')),(0,r.kt)("h3",{id:"\u57fa\u4e8e\u4e00\u81f4\u6027hash\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"},"\u57fa\u4e8e\u4e00\u81f4\u6027Hash\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"),(0,r.kt)("p",null,"\u57fa\u4e8e\u4e00\u81f4\u6027Hash\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u5177\u5907\u8bf7\u6c42\u4eb2\u548c\u6027\uff0c\u5177\u6709\u76f8\u540c\u7279\u5f81\u7684\u8bf7\u6c42\u4f1a\u59cb\u7ec8\u8d1f\u8f7d\u5230\u76f8\u540c\u8282\u70b9\u4e0a\u3002Higress\u652f\u6301\u57fa\u4e8e\u90e8\u5206Nginx \u53d8\u91cf\u3001\u8bf7\u6c42Header\u548c\u8bf7\u6c42\u8def\u5f84\u53c2\u6570\u4f5c\u4e3aHash Key\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/upstream-hash-by\uff1a\u57fa\u4e8e\u4e00\u81f4Hash\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u3002Higress\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u5f62\u5f0f\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u652f\u6301\u914d\u7f6e\u90e8\u5206nginx\u53d8\u91cf\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"$request_uri\uff1a\u8bf7\u6c42\u7684Path\uff08\u5305\u62ec\u8def\u5f84\u53c2\u6570\uff09\u4f5c\u4e3aHash Key"),(0,r.kt)("li",{parentName:"ul"},"$host\uff1a\u8bf7\u6c42\u7684Host\u4f5c\u4e3aHash Key"),(0,r.kt)("li",{parentName:"ul"},"$remote_addr\uff1a\u8bf7\u6c42\u7684\u5ba2\u6237\u7aefIP\u4f5c\u4e3aHash Key"))),(0,r.kt)("li",{parentName:"ul"},"\u57fa\u4e8e\u8bf7\u6c42header\u7684\u4e00\u81f4\u6027Hash\u3002\u60a8\u53ea\u9700\u914d\u7f6e\u4e3a$http_headerName\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u57fa\u4e8e\u8bf7\u6c42\u8def\u5f84\u53c2\u6570\u7684\u4e00\u81f4\u6027Hash\u3002\u60a8\u53ea\u9700\u914d\u7f6e\u4e3a$arg_varName\u3002")))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u57fa\u4e8e\u8bf7\u6c42\u7684\u5ba2\u6237\u7aefIP\u4f5c\u4e3aHash Key\uff0c\u540c\u4e00\u4e2a\u5ba2\u6237\u7aefIP\u7684\u8bf7\u6c42\u59cb\u7ec8\u8d1f\u8f7d\u5230\u540c\u4e00\u4e2a\u8282\u70b9\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/upstream-hash-by: "$remote_addr"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u57fa\u4e8e\u8bf7\u6c42Header x-stage\u4f5c\u4e3aHash key\uff0c\u5e26\u6709x-stage\u5934\u90e8\u7684\u8bf7\u6c42\u4e14\u503c\u76f8\u540c\u7684\u8bf7\u6c42\u59cb\u7ec8\u8d1f\u8f7d\u5230\u540c\u4e00\u4e2a\u8282\u70b9\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/upstream-hash-by: "$http_x-stage"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u57fa\u4e8e\u8bf7\u6c42\u8def\u5f84\u53c2\u6570 x-stage\u4f5c\u4e3aHash key\uff0c\u5e26\u6709\u8def\u5f84\u53c2\u6570x-stage\u7684\u8bf7\u6c42\u4e14\u503c\u76f8\u540c\u7684\u8bf7\u6c42\u59cb\u7ec8\u8d1f\u8f7d\u5230\u540c\u4e00\u4e2a\u8282\u70b9\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/upstream-hash-by: "$arg_x-stage"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"cookie\u4eb2\u548c\u6027-\u4f1a\u8bdd\u4fdd\u6301"},"Cookie\u4eb2\u548c\u6027 \uff08\u4f1a\u8bdd\u4fdd\u6301\uff09"),(0,r.kt)("p",null,"\u5177\u5907\u76f8\u540c\u7684Cookie\u7684\u8bf7\u6c42\u4f1a\u88ab\u7f51\u5173\u59cb\u7ec8\u8d1f\u8f7d\u5230\u540c\u4e00\u4e2a\u8282\u70b9\uff0c\u5e76\u4e14\u5982\u679c\u7b2c\u4e00\u6b21\u8bbf\u95ee\u643a\u5e26Cookie\uff0cHigress\u4f1a\u5728\u7b2c\u4e00\u6b21\u54cd\u5e94\u65f6\u4e3a\u5ba2\u6237\u7aef\u751f\u6210\u4e00\u4e2aCookie\uff0c\u7528\u6765\u4fdd\u8bc1\u540e\u7eed\u7684\u8bf7\u6c42\u88ab\u7f51\u5173\u59cb\u7ec8\u8d1f\u8f7d\u5230\u76f8\u540c\u8282\u70b9\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/affinity\uff1a\u4eb2\u548c\u6027\u79cd\u7c7b\uff0c\u76ee\u524d\u53ea\u652f\u6301cookie\uff0c\u9ed8\u8ba4\u4e3acookie\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/affinity-mode\uff1a\u4eb2\u548c\u6027\u6a21\u5f0f\uff0cHigress\u76ee\u524d\u53ea\u652f\u6301balanced\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3abalanced\u6a21\u5f0f\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/session-cookie-name\uff1a\u914d\u7f6e\u6307\u5b9aCookie\u7684\u503c\u4f5c\u4e3aHash Key\uff0c\u9ed8\u8ba4\u4e3aINGRESSCOOKIE"),(0,r.kt)("li",{parentName:"ul"},"higress.io/session-cookie-path\uff1a\u5f53\u6307\u5b9aCookie\u4e0d\u5b58\u5728\uff0c\u751f\u6210\u7684Cookie\u7684Path\u503c\uff0c\u9ed8\u8ba4\u4e3a/"),(0,r.kt)("li",{parentName:"ul"},"higress.io/session-cookie-max-age\uff1a\u5f53\u6307\u5b9aCookie\u4e0d\u5b58\u5728\uff0c\u751f\u6210\u7684Cookie\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c\u9ed8\u8ba4\u4e3aSession\u4f1a\u8bdd\u7ea7\u522b\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/session-cookie-expires\uff1a\u5f53\u6307\u5b9aCookie\u4e0d\u5b58\u5728\uff0c\u751f\u6210\u7684Cookie\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c\u9ed8\u8ba4\u4e3aSession\u4f1a\u8bdd\u7ea7\u522b\u3002",(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"\u8bf4\u660e\uff1amax-age\u548cexpires\u90fd\u53ef\u4ee5\u7528\u6765\u6307\u5b9acookie\u8fc7\u671f\u65f6\u95f4\u3002\u5f53session-cookie-max-age\u548csession-cookie-expires\u540c\u65f6\u914d\u7f6e\u65f6\uff0cHigress\u4f18\u5148\u9009\u53d6session-cookie-max-age\u4f5c\u4e3a\u8fc7\u671f\u65f6\u95f4\u3002")))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5f00\u542fCookie\u4eb2\u548c\u6027\uff0c\u5229\u7528Higress\u7684\u9ed8\u8ba4\u914d\u7f6e\uff0c\u5373Cookie\u7684\u540d\u5b57\u4e3aINGRESSCOOKIE\uff0cPath\u4e3a/\uff0cCookie\u7684\u751f\u547d\u5468\u671f\u4e3aSession\u4f1a\u8bdd\u7ea7\u522b\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/affinity: "cookie"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5f00\u542fCookie\u4eb2\u548c\u6027\uff0cCookie\u7684\u540d\u5b57\u4e3atest\uff0cPath\u4e3a/\uff0cCookie\u7684\u8fc7\u671f\u65f6\u95f4\u4e3a10s\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/affinity: "cookie"\n    higress.io/session-cookie-name: "test"\n    higress.io/session-cookie-max-age: "10"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')),(0,r.kt)("h2",{id:"\u7f51\u5173\u4e0e\u540e\u7aef\u670d\u52a1\u53cc\u5411\u8ba4\u8bc1mtls"},"\u7f51\u5173\u4e0e\u540e\u7aef\u670d\u52a1\u53cc\u5411\u8ba4\u8bc1\uff08MTLS)"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cHigress\u9ed8\u8ba4\u4f7f\u7528HTTP\u534f\u8bae\u8f6c\u53d1\u8bf7\u6c42\u5230\u540e\u7aef\u4e1a\u52a1\u5bb9\u5668\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u6ce8\u89e3",(0,r.kt)("inlineCode",{parentName:"p"},'higress.io/backend-protocol: "HTTPS"'),"\u914d\u7f6eHigress\u8bbf\u95ee\u540e\u7aef\u670d\u52a1\u4f7f\u7528HTTPS\u534f\u8bae\uff0c\u4f46\u8fd9\u662f\u5355\u5411TLS\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ea\u6709Higress\u4f1a\u9a8c\u8bc1\u540e\u7aef\u670d\u52a1\u63d0\u4f9b\u7684\u8bc1\u4e66\uff0c\u4e14\u4e00\u822c\u540e\u7aef\u670d\u52a1\u4f7f\u7528\u7684\u8bc1\u4e66\u9700\u8981\u662f\u6743\u5a01CA\u7b7e\u53d1\u7684\u3002\u53e6\u4e00\u79cd\u66f4\u5b89\u5168\u7684\u6a21\u5f0f\u662f\u96f6\u4fe1\u4efb\uff0c\u7f51\u5173\u4f1a\u9a8c\u8bc1\u540e\u7aef\u670d\u52a1\u7684\u8bc1\u4e66\u662f\u5426\u5408\u6cd5\uff0c\u540c\u6837\u540e\u7aef\u670d\u52a1\u4e5f\u4f1a\u9a8c\u8bc1\u7f51\u5173\u63d0\u4f9b\u7684\u8bc1\u4e66\u662f\u5426\u5408\u6cd5\uff0c\u8fd9\u5c31\u662fMTLS\uff0c\u7f51\u5173\u4e0e\u540e\u7aef\u670d\u52a1\u8fdb\u884c\u53cc\u5411\u8ba4\u8bc1\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"higress.io/proxy-ssl-secret\uff1a\u7f51\u5173\u4f7f\u7528\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u7528\u4e8e\u540e\u7aef\u670d\u52a1\u5bf9\u7f51\u5173\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff0c\u683c\u5f0f\u4e3a secretNamespace/secretName\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/proxy-ssl-name\uff1aTLS\u63e1\u624b\u671f\u95f4\u4f7f\u7528\u7684SNI\u3002"),(0,r.kt)("li",{parentName:"ul"},"higress.io/proxy-ssl-server-name\uff1aon or off\u3002\u5f00\u542f\u6216\u5173\u95edTLS\u63e1\u624b\u671f\u95f4\u4f7f\u7528SNI\u3002")),(0,r.kt)("p",null,"\u7f51\u5173\u4e0e\u540e\u7aef\u670d\u52a1\u8fdb\u884c\u53cc\u5411\u8ba4\u8bc1\uff0c\u7f51\u5173\u4f7f\u7528\u7684secret name\u4e3agateway-cert\uff0c\u547d\u540d\u7a7a\u4e3adefault\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    higress.io/proxy-ssl-secret: "default/gateway-cert"\n  name: demo\nspec:\n  ingressClassName: higress\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo-service\n                port: \n                  number: 80\n            path: /test\n            pathType: Exact\n')))}k.isMDXComponent=!0}}]);