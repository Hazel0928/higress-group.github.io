"use strict";(self.webpackChunkhigress_website=self.webpackChunkhigress_website||[]).push([[4138],{3905:(t,e,n)=>{n.d(e,{Zo:()=>d,kt:()=>g});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var m=a.createContext({}),k=function(t){var e=a.useContext(m),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},d=function(t){var e=k(t.components);return a.createElement(m.Provider,{value:e},t.children)},o="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},N=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,m=t.parentName,d=p(t,["components","mdxType","originalType","parentName"]),o=k(n),N=r,g=o["".concat(m,".").concat(N)]||o[N]||u[N]||l;return n?a.createElement(g,i(i({ref:e},d),{},{components:n})):a.createElement(g,i({ref:e},d))}));function g(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,i=new Array(l);i[0]=N;var p={};for(var m in e)hasOwnProperty.call(e,m)&&(p[m]=e[m]);p.originalType=t,p[o]="string"==typeof t?t:r,i[1]=p;for(var k=2;k<l;k++)i[k]=n[k];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}N.displayName="MDXCreateElement"},2393:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>m,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>p,toc:()=>k});var a=n(7462),r=(n(7294),n(3905));const l={},i="\u529f\u80fd\u8bf4\u660e",p={unversionedId:"plugins/ai-token-ratelimit",id:"plugins/ai-token-ratelimit",title:"\u529f\u80fd\u8bf4\u660e",description:"ai-token-ratelimit\u63d2\u4ef6\u5b9e\u73b0\u4e86\u57fa\u4e8e\u7279\u5b9a\u952e\u503c\u5b9e\u73b0token\u9650\u6d41\uff0c\u952e\u503c\u6765\u6e90\u53ef\u4ee5\u662f URL \u53c2\u6570\u3001HTTP \u8bf7\u6c42\u5934\u3001\u5ba2\u6237\u7aef IP \u5730\u5740\u3001consumer \u540d\u79f0\u3001cookie\u4e2d key \u540d\u79f0",source:"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/plugins/ai-token-ratelimit.md",sourceDirName:"plugins",slug:"/plugins/ai-token-ratelimit",permalink:"/zh-cn/docs/plugins/ai-token-ratelimit",draft:!1,editUrl:"https://github.com/higress-group/higress-group.github.io/blob/main/i18n/zh-cn/docusaurus-plugin-content-docs/current/plugins/ai-token-ratelimit.md",tags:[],version:"current",frontMatter:{}},m={},k=[{value:"\u8bc6\u522b\u8bf7\u6c42\u53c2\u6570 apikey\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41",id:"\u8bc6\u522b\u8bf7\u6c42\u53c2\u6570-apikey\u8fdb\u884c\u533a\u522b\u9650\u6d41",level:2},{value:"\u8bc6\u522b\u8bf7\u6c42\u5934 x-ca-key\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41",id:"\u8bc6\u522b\u8bf7\u6c42\u5934-x-ca-key\u8fdb\u884c\u533a\u522b\u9650\u6d41",level:2},{value:"\u6839\u636e\u8bf7\u6c42\u5934 x-forwarded-for \u83b7\u53d6\u5bf9\u7aefIP\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41",id:"\u6839\u636e\u8bf7\u6c42\u5934-x-forwarded-for-\u83b7\u53d6\u5bf9\u7aefip\u8fdb\u884c\u533a\u522b\u9650\u6d41",level:2},{value:"\u8bc6\u522bconsumer\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41",id:"\u8bc6\u522bconsumer\u8fdb\u884c\u533a\u522b\u9650\u6d41",level:2},{value:"\u8bc6\u522bcookie\u4e2d\u7684\u952e\u503c\u5bf9\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41",id:"\u8bc6\u522bcookie\u4e2d\u7684\u952e\u503c\u5bf9\u8fdb\u884c\u533a\u522b\u9650\u6d41",level:2}],d={toc:k},o="wrapper";function u(t){let{components:e,...n}=t;return(0,r.kt)(o,(0,a.Z)({},d,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u529f\u80fd\u8bf4\u660e"},"\u529f\u80fd\u8bf4\u660e"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ai-token-ratelimit"),"\u63d2\u4ef6\u5b9e\u73b0\u4e86\u57fa\u4e8e\u7279\u5b9a\u952e\u503c\u5b9e\u73b0token\u9650\u6d41\uff0c\u952e\u503c\u6765\u6e90\u53ef\u4ee5\u662f URL \u53c2\u6570\u3001HTTP \u8bf7\u6c42\u5934\u3001\u5ba2\u6237\u7aef IP \u5730\u5740\u3001consumer \u540d\u79f0\u3001cookie\u4e2d key \u540d\u79f0"),(0,r.kt)("h1",{id:"\u914d\u7f6e\u8bf4\u660e"},"\u914d\u7f6e\u8bf4\u660e"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u914d\u7f6e\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u586b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"),(0,r.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"rule_name"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u9650\u6d41\u89c4\u5219\u540d\u79f0\uff0c\u6839\u636e\u9650\u6d41\u89c4\u5219\u540d\u79f0+\u9650\u6d41\u7c7b\u578b+\u9650\u6d41key\u540d\u79f0+\u9650\u6d41key\u5bf9\u5e94\u7684\u5b9e\u9645\u503c\u6765\u62fc\u88c5redis key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"rule_items"),(0,r.kt)("td",{parentName:"tr",align:null},"array of object"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u9650\u6d41\u89c4\u5219\u9879\uff0c\u6309\u7167rule_items\u4e0b\u7684\u6392\u5217\u987a\u5e8f\uff0c\u5339\u914d\u7b2c\u4e00\u4e2arule_item\u540e\u547d\u4e2d\u9650\u6d41\u89c4\u5219\uff0c\u540e\u7eed\u89c4\u5219\u5c06\u88ab\u5ffd\u7565")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"rejected_code"),(0,r.kt)("td",{parentName:"tr",align:null},"int"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"429"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8bf7\u6c42\u88ab\u9650\u6d41\u65f6\uff0c\u8fd4\u56de\u7684HTTP\u72b6\u6001\u7801")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"rejected_msg"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"Too many requests"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8bf7\u6c42\u88ab\u9650\u6d41\u65f6\uff0c\u8fd4\u56de\u7684\u54cd\u5e94\u4f53")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"redis"),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"redis\u76f8\u5173\u914d\u7f6e")))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"rule_items"),"\u4e2d\u6bcf\u4e00\u9879\u7684\u914d\u7f6e\u5b57\u6bb5\u8bf4\u660e"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u914d\u7f6e\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u586b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"),(0,r.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_header"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u914d\u7f6e\u83b7\u53d6\u9650\u6d41\u952e\u503c\u7684\u6765\u6e90 HTTP \u8bf7\u6c42\u5934\u540d\u79f0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_param"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u914d\u7f6e\u83b7\u53d6\u9650\u6d41\u952e\u503c\u7684\u6765\u6e90 URL \u53c2\u6570\u540d\u79f0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_consumer"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6839\u636e consumer \u540d\u79f0\u8fdb\u884c\u9650\u6d41\uff0c\u65e0\u9700\u6dfb\u52a0\u5b9e\u9645\u503c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_cookie"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u914d\u7f6e\u83b7\u53d6\u9650\u6d41\u952e\u503c\u7684\u6765\u6e90 Cookie\u4e2d key \u540d\u79f0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_per_header"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6309\u89c4\u5219\u5339\u914d\u7279\u5b9a HTTP \u8bf7\u6c42\u5934\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u8bf7\u6c42\u5934\u5206\u522b\u8ba1\u7b97\u9650\u6d41\uff0c\u914d\u7f6e\u83b7\u53d6\u9650\u6d41\u952e\u503c\u7684\u6765\u6e90 HTTP \u8bf7\u6c42\u5934\u540d\u79f0\uff0c\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"td"},"limit_keys"),"\u65f6\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u6216",(0,r.kt)("inlineCode",{parentName:"td"},"*"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_per_param"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6309\u89c4\u5219\u5339\u914d\u7279\u5b9a URL \u53c2\u6570\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u53c2\u6570\u5206\u522b\u8ba1\u7b97\u9650\u6d41\uff0c\u914d\u7f6e\u83b7\u53d6\u9650\u6d41\u952e\u503c\u7684\u6765\u6e90 URL \u53c2\u6570\u540d\u79f0\uff0c\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"td"},"limit_keys"),"\u65f6\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u6216",(0,r.kt)("inlineCode",{parentName:"td"},"*"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_per_consumer"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6309\u89c4\u5219\u5339\u914d\u7279\u5b9a consumer\uff0c\u5e76\u5bf9\u6bcf\u4e2a consumer \u5206\u522b\u8ba1\u7b97\u9650\u6d41\uff0c\u6839\u636e consumer \u540d\u79f0\u8fdb\u884c\u9650\u6d41\uff0c\u65e0\u9700\u6dfb\u52a0\u5b9e\u9645\u503c\uff0c\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"td"},"limit_keys"),"\u65f6\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u6216",(0,r.kt)("inlineCode",{parentName:"td"},"*"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_per_cookie"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6309\u89c4\u5219\u5339\u914d\u7279\u5b9a Cookie\uff0c\u5e76\u5bf9\u6bcf\u4e2a Cookie \u5206\u522b\u8ba1\u7b97\u9650\u6d41\uff0c\u914d\u7f6e\u83b7\u53d6\u9650\u6d41\u952e\u503c\u7684\u6765\u6e90 Cookie\u4e2d key \u540d\u79f0\uff0c\u914d\u7f6e",(0,r.kt)("inlineCode",{parentName:"td"},"limit_keys"),"\u65f6\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u6216",(0,r.kt)("inlineCode",{parentName:"td"},"*"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_by_per_ip"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_*"),"\u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6309\u89c4\u5219\u5339\u914d\u7279\u5b9a IP\uff0c\u5e76\u5bf9\u6bcf\u4e2a IP \u5206\u522b\u8ba1\u7b97\u9650\u6d41\uff0c\u914d\u7f6e\u83b7\u53d6\u9650\u6d41\u952e\u503c\u7684\u6765\u6e90 IP \u53c2\u6570\u540d\u79f0\uff0c\u4ece\u8bf7\u6c42\u5934\u83b7\u53d6\uff0c\u4ee5",(0,r.kt)("inlineCode",{parentName:"td"},"from-header-\u5bf9\u5e94\u7684header\u540d"),"\uff0c\u793a\u4f8b\uff1a",(0,r.kt)("inlineCode",{parentName:"td"},"from-header-x-forwarded-for"),"\uff0c\u76f4\u63a5\u83b7\u53d6\u5bf9\u7aefsocket ip\uff0c\u914d\u7f6e\u4e3a",(0,r.kt)("inlineCode",{parentName:"td"},"from-remote-addr"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"limit_keys"),(0,r.kt)("td",{parentName:"tr",align:null},"array of object"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u914d\u7f6e\u5339\u914d\u952e\u503c\u540e\u7684\u9650\u6d41\u6b21\u6570")))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"limit_keys"),"\u4e2d\u6bcf\u4e00\u9879\u7684\u914d\u7f6e\u5b57\u6bb5\u8bf4\u660e"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u914d\u7f6e\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u586b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"),(0,r.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"key"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5339\u914d\u7684\u952e\u503c\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_per_header"),",",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_per_param"),",",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_per_consumer"),",",(0,r.kt)("inlineCode",{parentName:"td"},"limit_by_per_cookie")," \u7c7b\u578b\u652f\u6301\u914d\u7f6e\u6b63\u5219\u8868\u8fbe\u5f0f\uff08\u4ee5regexp:\u5f00\u5934\u540e\u9762\u8ddf\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u6216\u8005",(0,r.kt)("em",{parentName:"td"},"\uff08\u4ee3\u8868\u6240\u6709\uff09\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u793a\u4f8b\uff1a`regexp:^d."),(0,r.kt)("inlineCode",{parentName:"td"},"\uff08\u4ee5d\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff09\uff1b"),"limit_by_per_ip`\u652f\u6301\u914d\u7f6e IP \u5730\u5740\u6216 IP \u6bb5")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"token_per_second"),(0,r.kt)("td",{parentName:"tr",align:null},"int"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_second"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_minute"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_hour"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_day")," \u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5141\u8bb8\u6bcf\u79d2\u8bf7\u6c42token\u6570")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"token_per_minute"),(0,r.kt)("td",{parentName:"tr",align:null},"int"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_second"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_minute"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_hour"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_day")," \u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5141\u8bb8\u6bcf\u5206\u949f\u8bf7\u6c42token\u6570")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"token_per_hour"),(0,r.kt)("td",{parentName:"tr",align:null},"int"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_second"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_minute"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_hour"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_day")," \u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5141\u8bb8\u6bcf\u5c0f\u65f6\u8bf7\u6c42token\u6570")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"token_per_day"),(0,r.kt)("td",{parentName:"tr",align:null},"int"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_second"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_minute"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_hour"),",",(0,r.kt)("inlineCode",{parentName:"td"},"token_per_day")," \u4e2d\u9009\u586b\u4e00\u9879"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5141\u8bb8\u6bcf\u5929\u8bf7\u6c42token\u6570")))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"redis"),"\u4e2d\u6bcf\u4e00\u9879\u7684\u914d\u7f6e\u5b57\u6bb5\u8bf4\u660e"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u914d\u7f6e\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u586b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"),(0,r.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"service_name"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5fc5\u586b"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"redis \u670d\u52a1\u540d\u79f0\uff0c\u5e26\u670d\u52a1\u7c7b\u578b\u7684\u5b8c\u6574 FQDN \u540d\u79f0\uff0c\u4f8b\u5982 my-redis.dns\u3001redis.my-ns.svc.cluster.local")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"service_port"),(0,r.kt)("td",{parentName:"tr",align:null},"int"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"\u670d\u52a1\u7c7b\u578b\u4e3a\u56fa\u5b9a\u5730\u5740\uff08static service\uff09\u9ed8\u8ba4\u503c\u4e3a80\uff0c\u5176\u4ed6\u4e3a6379"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8f93\u5165redis\u670d\u52a1\u7684\u670d\u52a1\u7aef\u53e3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"username"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"redis\u7528\u6237\u540d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"password"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"redis\u5bc6\u7801")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"timeout"),(0,r.kt)("td",{parentName:"tr",align:null},"int"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"1000"),(0,r.kt)("td",{parentName:"tr",align:null},"redis\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u6beb\u79d2")))),(0,r.kt)("h1",{id:"\u914d\u7f6e\u793a\u4f8b"},"\u914d\u7f6e\u793a\u4f8b"),(0,r.kt)("h2",{id:"\u8bc6\u522b\u8bf7\u6c42\u53c2\u6570-apikey\u8fdb\u884c\u533a\u522b\u9650\u6d41"},"\u8bc6\u522b\u8bf7\u6c42\u53c2\u6570 apikey\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'rule_name: default_rule\nrule_items:\n  - limit_by_param: apikey\n    limit_keys:\n      - key: 9a342114-ba8a-11ec-b1bf-00163e1250b5\n        token_per_minute: 10\n      - key: a6a6d7f2-ba8a-11ec-bec2-00163e1250b5\n        token_per_hour: 100\n  - limit_by_per_param: apikey\n    limit_keys:\n      # \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ee5a\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2aapikey\u5bf9\u5e94\u7684\u8bf7\u6c4210qds\n      - key: "regexp:^a.*"\n        token_per_second: 10\n      # \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ee5b\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2aapikey\u5bf9\u5e94\u7684\u8bf7\u6c42100qd\n      - key: "regexp:^b.*"\n        token_per_minute: 100\n      # \u515c\u5e95\u7528\uff0c\u5339\u914d\u6240\u6709\u8bf7\u6c42\uff0c\u6bcf\u4e2aapikey\u5bf9\u5e94\u7684\u8bf7\u6c421000qdh\n      - key: "*"\n        token_per_hour: 1000\nredis:\n  service_name: redis.static\n')),(0,r.kt)("h2",{id:"\u8bc6\u522b\u8bf7\u6c42\u5934-x-ca-key\u8fdb\u884c\u533a\u522b\u9650\u6d41"},"\u8bc6\u522b\u8bf7\u6c42\u5934 x-ca-key\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'rule_name: default_rule\nrule_items:\n  - limit_by_header: x-ca-key\n    limit_keys:\n        - key: 102234\n        token_per_minute: 10\n      - key: 308239\n        token_per_hour: 10\n  - limit_by_per_header: x-ca-key\n    limit_keys:\n      # \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ee5a\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2aapikey\u5bf9\u5e94\u7684\u8bf7\u6c4210qds\n      - key: "regexp:^a.*"\n        token_per_second: 10\n      # \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ee5b\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2aapikey\u5bf9\u5e94\u7684\u8bf7\u6c42100qd\n      - key: "regexp:^b.*"\n        token_per_minute: 100\n      # \u515c\u5e95\u7528\uff0c\u5339\u914d\u6240\u6709\u8bf7\u6c42\uff0c\u6bcf\u4e2aapikey\u5bf9\u5e94\u7684\u8bf7\u6c421000qdh\n      - key: "*"\n        token_per_hour: 1000            \nredis:\n  service_name: redis.static\n')),(0,r.kt)("h2",{id:"\u6839\u636e\u8bf7\u6c42\u5934-x-forwarded-for-\u83b7\u53d6\u5bf9\u7aefip\u8fdb\u884c\u533a\u522b\u9650\u6d41"},"\u6839\u636e\u8bf7\u6c42\u5934 x-forwarded-for \u83b7\u53d6\u5bf9\u7aefIP\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"rule_name: default_rule\nrule_items:\n  - limit_by_per_ip: from-header-x-forwarded-for\n    limit_keys:\n      # \u7cbe\u786eip\n      - key: 1.1.1.1\n        token_per_day: 10\n      # ip\u6bb5\uff0c\u7b26\u5408\u8fd9\u4e2aip\u6bb5\u7684ip\uff0c\u6bcf\u4e2aip 100qpd\n      - key: 1.1.1.0/24\n        token_per_day: 100\n      # \u515c\u5e95\u7528\uff0c\u5373\u9ed8\u8ba4\u6bcf\u4e2aip 1000qpd\n      - key: 0.0.0.0/0\n        token_per_day: 1000\nredis:\n  service_name: redis.static\n")),(0,r.kt)("h2",{id:"\u8bc6\u522bconsumer\u8fdb\u884c\u533a\u522b\u9650\u6d41"},"\u8bc6\u522bconsumer\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'rule_name: default_rule\nrule_items:\n  - limit_by_consumer: \'\'\n    limit_keys:\n      - key: consumer1\n        token_per_second: 10\n      - key: consumer2\n        token_per_hour: 100\n  - limit_by_per_consumer: \'\'\n    limit_keys:\n      # \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ee5a\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2aconsumer\u5bf9\u5e94\u7684\u8bf7\u6c4210qds\n      - key: "regexp:^a.*"\n        token_per_second: 10\n      # \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ee5b\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2aconsumer\u5bf9\u5e94\u7684\u8bf7\u6c42100qd\n      - key: "regexp:^b.*"\n        token_per_minute: 100\n      # \u515c\u5e95\u7528\uff0c\u5339\u914d\u6240\u6709\u8bf7\u6c42\uff0c\u6bcf\u4e2aconsumer\u5bf9\u5e94\u7684\u8bf7\u6c421000qdh\n      - key: "*"\n        token_per_hour: 1000     \nredis:\n  service_name: redis.static\n')),(0,r.kt)("h2",{id:"\u8bc6\u522bcookie\u4e2d\u7684\u952e\u503c\u5bf9\u8fdb\u884c\u533a\u522b\u9650\u6d41"},"\u8bc6\u522bcookie\u4e2d\u7684\u952e\u503c\u5bf9\uff0c\u8fdb\u884c\u533a\u522b\u9650\u6d41"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'rule_name: default_rule\nrule_items:\n  - limit_by_cookie: key1\n    limit_keys:\n      - key: value1\n        token_per_minute: 10\n      - key: value2\n        token_per_hour: 100\n  - limit_by_per_cookie: key1\n    limit_keys:\n      # \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ee5a\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2acookie\u4e2d\u7684value\u5bf9\u5e94\u7684\u8bf7\u6c4210qds\n      - key: "regexp:^a.*"\n        token_per_second: 10\n      # \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ee5b\u5f00\u5934\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2acookie\u4e2d\u7684value\u5bf9\u5e94\u7684\u8bf7\u6c42100qd\n      - key: "regexp:^b.*"\n        token_per_minute: 100\n      # \u515c\u5e95\u7528\uff0c\u5339\u914d\u6240\u6709\u8bf7\u6c42\uff0c\u6bcf\u4e2acookie\u4e2d\u7684value\u5bf9\u5e94\u7684\u8bf7\u6c421000qdh\n      - key: "*"\n        token_per_hour: 1000 \nrejected_code: 200\nrejected_msg: \'{"code":-1,"msg":"Too many requests"}\'\nredis:\n  service_name: redis.static\n')))}u.isMDXComponent=!0}}]);