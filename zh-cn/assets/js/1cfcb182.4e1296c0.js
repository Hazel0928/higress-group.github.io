"use strict";(self.webpackChunkhigress_website=self.webpackChunkhigress_website||[]).push([[7431],{3905:(e,r,t)=>{t.d(r,{Zo:()=>u,kt:()=>d});var n=t(7294);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?s(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=n.createContext({}),l=function(e){var r=n.useContext(p),t=r;return e&&(t="function"==typeof e?e(r):o(o({},r),e)),t},u=function(e){var r=l(e.components);return n.createElement(p.Provider,{value:r},e.children)},g="mdxType",m={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},c=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,s=e.originalType,p=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),g=l(t),c=a,d=g["".concat(p,".").concat(c)]||g[c]||m[c]||s;return t?n.createElement(d,o(o({ref:r},u),{},{components:t})):n.createElement(d,o({ref:r},u))}));function d(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var s=t.length,o=new Array(s);o[0]=c;var i={};for(var p in r)hasOwnProperty.call(r,p)&&(i[p]=r[p]);i.originalType=e,i[g]="string"==typeof e?e:a,o[1]=i;for(var l=2;l<s;l++)o[l]=t[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}c.displayName="MDXCreateElement"},7876:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var n=t(7462),a=(t(7294),t(3905));const s={title:"\u901a\u8fc7 Higress Wasm \u63d2\u4ef6 3 \u500d\u6027\u80fd\u5b9e\u73b0 Spring-cloud-gateway \u529f\u80fd",keywords:["Higress","Wasm"],description:"\u901a\u8fc7 Higress Wasm \u63d2\u4ef6 3 \u500d\u6027\u80fd\u5b9e\u73b0 Spring-cloud-gateway \u529f\u80fd",author:"WeixinX",date:new Date("2023-10-27T00:00:00.000Z")},o=void 0,i={permalink:"/zh-cn/blog/plugin-transformer",editUrl:"https://github.com/higress-group/higress-group.github.io/blob/main/i18n/zh-cn/docusaurus-plugin-content-blog/plugin-transformer.md",source:"@site/i18n/zh-cn/docusaurus-plugin-content-blog/plugin-transformer.md",title:"\u901a\u8fc7 Higress Wasm \u63d2\u4ef6 3 \u500d\u6027\u80fd\u5b9e\u73b0 Spring-cloud-gateway \u529f\u80fd",description:"\u901a\u8fc7 Higress Wasm \u63d2\u4ef6 3 \u500d\u6027\u80fd\u5b9e\u73b0 Spring-cloud-gateway \u529f\u80fd",date:"2023-10-27T00:00:00.000Z",formattedDate:"2023\u5e7410\u670827\u65e5",tags:[],readingTime:10.3,hasTruncateMarker:!1,authors:[{name:"WeixinX"}],frontMatter:{title:"\u901a\u8fc7 Higress Wasm \u63d2\u4ef6 3 \u500d\u6027\u80fd\u5b9e\u73b0 Spring-cloud-gateway \u529f\u80fd",keywords:["Higress","Wasm"],description:"\u901a\u8fc7 Higress Wasm \u63d2\u4ef6 3 \u500d\u6027\u80fd\u5b9e\u73b0 Spring-cloud-gateway \u529f\u80fd",author:"WeixinX",date:"2023-10-27T00:00:00.000Z"},prevItem:{title:"Higress \u5f00\u6e90\u4e00\u5468\u5e74\uff1a\u65b0\u7248\u672c\uff0c\u65b0\u6807\u51c6\uff0c\u65b0\u5de5\u5177\uff0c\u65b0\u5f81\u7a0b",permalink:"/zh-cn/blog/release-1.3"},nextItem:{title:"Higress\u57282023 KubeCon China\u7684\u5206\u4eab",permalink:"/zh-cn/blog/2023-kubecon"}},p={authorsImageUrls:[void 0]},l=[],u={toc:l},g="wrapper";function m(e){let{components:r,...t}=e;return(0,a.kt)(g,(0,n.Z)({},u,t,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5bfc\u8bfb: \u672c\u6587\u5c06\u548c\u5927\u5bb6\u4e00\u540c\u56de\u987e Spring Cloud Gateway \u662f\u5982\u4f55\u6ee1\u8db3 HTTP \u8bf7\u6c42/\u54cd\u5e94\u8f6c\u6362\u9700\u6c42\u573a\u666f\u7684\uff0c\u5e76\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\u4f7f\u7528 Higress \u4e91\u539f\u751f\u7f51\u5173\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u540c\u65f6\u8fd8\u5bf9\u6bd4\u4e86\u4e24\u8005\u7684\u6027\u80fd\u5dee\u5f02\u3002")),(0,a.kt)("h1",{id:"1-scg-\u4fee\u6539\u8bf7\u6c42\u54cd\u5e94"},"1. SCG \u4fee\u6539\u8bf7\u6c42/\u54cd\u5e94"),(0,a.kt)("p",null,"\u5728 ",(0,a.kt)("a",{parentName:"p",href:"https://cloud.spring.io/spring-cloud-gateway/reference/html/"},"Spring Cloud Gateway")," (\u4ee5\u4e0b\u7b80\u79f0\u4e3a SCG) \u4e2d\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9 HTTP \u8bf7\u6c42\u6216\u54cd\u5e94\u8fdb\u884c\u4fee\u6539\u65f6\uff0cSCG \u63d0\u4f9b\u4e86\u8bb8\u591a\u5185\u7f6e\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://cloud.spring.io/spring-cloud-gateway/reference/html/#gatewayfilter-factories"},"GatewayFilter")," \u6765\u6ee1\u8db3\u6211\u4eec\u5bf9\u8fd9\u79cd\u5e94\u7528\u573a\u666f\u7684\u9700\u6c42\uff0c\u4f8b\u5982 AddRequestHeader,AddRequestParameter, DedupeResponseHeader,MapRequestHeader, ModifyRequestBody \u7b49\u3002"),(0,a.kt)("p",null,"\u8003\u8651\u4ee5\u4e0b\u7b80\u5355\u7528\u4f8b\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'\u6dfb\u52a0\u8bf7\u6c42\u5934\u90e8 X-First\uff0c\u503c\u4ece\u8bf7\u6c42\u8def\u5f84\u4e2d\u83b7\u53d6\uff0c\u4f8b\u5982\u4ece /response-headers?testKey=testValue \u4e2d\u83b7\u53d6 "response-headers"\uff1b'),(0,a.kt)("li",{parentName:"ul"},"\u5c06\u8bf7\u6c42\u5934\u90e8 X-First \u7684\u503c\u6620\u5c04\u7ed9 X-Second\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u6dfb\u52a0\u8bf7\u6c42\u67e5\u8be2\u53c2\u6570 k1=v1\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u5254\u9664\u91cd\u590d\u7684\u54cd\u5e94\u5934\u90e8 X-Dedupe\u3002")),(0,a.kt)("p",null,"\u5728 SCG \u4e2d\u4f7f\u7528 GatewayFilter \u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u914d\u7f6e\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# application.yaml:\n\nspring:\n  cloud:\n    gateway:\n      routes:\n        - id: test_route\n          uri: lb://httpbin-svc\n          predicates:\n            - Path=/{api}/**\n          filters:\n            - AddRequestHeader=X-First, {api}\n            - MapRequestHeader=X-First, X-Second\n            - AddRequestParameter=k1, v1\n            - DedupeResponseHeader=X-Dedupe, RETAIN_FIRST\n")),(0,a.kt)("p",null,"\u76f8\u4fe1\u62e5\u6709 SCG \u4f7f\u7528\u7ecf\u9a8c\u7684\u540c\u5b66\u5bf9\u4e0a\u8ff0\u914d\u7f6e\u4e00\u5b9a\u4e0d\u964c\u751f\uff0c\u90a3\u4e48\u672c\u6587\u5c06\u91cd\u70b9\u7ed9\u51fa\u53e6\u4e00\u79cd\u80fd\u591f",(0,a.kt)("strong",{parentName:"p"},"\u6ee1\u8db3\u4e0a\u8ff0\u9700\u6c42\u5e76\u4e14\u6027\u80fd\u66f4\u52a0\u4f18\u8d8a\u7684\u89e3\u51b3\u65b9\u6848\u2014\u2014\u4f7f\u7528 Higress \u4e91\u539f\u751f\u7f51\u5173\u7684 Transformer \u63d2\u4ef6"),"\u3002"),(0,a.kt)("h1",{id:"2-higress-\u63d2\u4ef6\u4e0e-scg-\u6027\u80fd\u6bd4\u8f83"},"2. Higress \u63d2\u4ef6\u4e0e SCG \u6027\u80fd\u6bd4\u8f83"),(0,a.kt)("p",null,"\u6211\u4eec\u5728\u540c\u4e00\u541e\u5410\u91cf\u6c34\u5e73\uff08QPS\uff09\u4e0a\uff0c\u5f00\u542f/\u5173\u95ed ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/alibaba/higress/tree/main/plugins/wasm-go/extensions/transformer"},"Higress Transformer \u63d2\u4ef6")," \u548c SCG \u76f8\u5e94 GatewayFilters\uff0c\u7edf\u8ba1\u4e24\u8005\u5728 CPU \u548c\u5185\u5b58\u8d44\u6e90\u4e0a\u7684\u5f00\u9500\u3002"),(0,a.kt)("p",null,"\u7ecf\u8fc7",(0,a.kt)("a",{parentName:"p",href:"https://gist.github.com/WeixinX/c24f4ded37832dd7e753b2d27470f0fc"},"\u6d4b\u8bd5"),"\uff0c\u6211\u4eec\u5f97\u5230\u7684\u7ed3\u8bba\u662f\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5728 Higress \u672a\u542f\u7528 Transformer \u63d2\u4ef6\uff0cSCG \u672a\u542f\u7528 GatewayFilters \u7684\u6761\u4ef6\u4e0b\uff0cSCG \u7684 CPU, \u5185\u5b58\u8d44\u6e90\u5f00\u9500\u5206\u522b\u7ea6\u4e3a Higress\u7684 3.30, 4.88\u500d\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u5728 Higress \u542f\u7528 Transformer \u63d2\u4ef6\uff0cSCG \u542f\u7528\u76f8\u5e94 GatewayFilters \u7684\u6761\u4ef6\u4e0b\uff0cSCG \u7684 CPU,\u5185\u5b58\u8d44\u6e90\u5f00\u9500\u5206\u522b\u7ea6\u4e3a Higress \u7684 2.98, 3.19\u500d\u3002")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://github.com/higress-group/higress-group.github.io/assets/49450531/61d3ec0b-b708-41e6-9f28-96108b4b55c6",alt:"\u76f8\u540c QPS \u4e0b\u7684 CPU \u5f00\u9500"})),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://github.com/higress-group/higress-group.github.io/assets/49450531/a60415d5-bed6-47cf-a976-b8e55a818e14",alt:"\u76f8\u540c QPS \u4e0b\u7684\u5185\u5b58\u5f00\u9500"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u53ef\u89c1 Higress Transformer \u76f8\u6bd4\u4e8e SCG GatewayFilter \u6709\u7740\u76f8\u5f53\u4e0d\u9519\u7684\u6027\u80fd\u8868\u73b0\uff01")),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u8fdb\u4e00\u6b65\u4e3a\u5927\u5bb6\u4ecb\u7ecd Higress \u4e91\u539f\u751f\u7f51\u5173\u4ee5\u53ca\u4e0a\u8ff0\u63d0\u5230\u7684 Higress Transformer \u63d2\u4ef6\u3002"),(0,a.kt)("h1",{id:"3-higress-\u7b80\u4ecb"},"3. Higress \u7b80\u4ecb"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://higress.io/zh-cn/"},"Higress")," \u662f\u57fa\u4e8e\u963f\u91cc\u5185\u90e8\u7684 Envoy Gateway \u5b9e\u8df5\u6c89\u6dc0\u3001\u4ee5\u5f00\u6e90 Istio + Envoy \u4e3a\u6838\u5fc3\u6784\u5efa\u7684\u4e0b\u4e00\u4ee3\u4e91\u539f\u751f\u7f51\u5173\uff0c\u5b9e\u73b0\u4e86\u6d41\u91cf\u7f51\u5173+\u5fae\u670d\u52a1\u7f51\u5173+\u5b89\u5168\u7f51\u5173\u4e09\u5408\u4e00\u7684\u9ad8\u96c6\u6210\u80fd\u529b\uff0c\u6df1\u5ea6\u96c6\u6210 Dubbo\u3001Nacos\u3001Sentinel \u7b49\u5fae\u670d\u52a1\u6280\u672f\u6808\uff0c\u80fd\u591f\u5e2e\u52a9\u7528\u6237\u6781\u5927\u5730\u964d\u4f4e\u7f51\u5173\u7684\u90e8\u7f72\u53ca\u8fd0\u7ef4\u6210\u672c\u4e14\u80fd\u529b\u4e0d\u6253\u6298\uff1b\u5728\u6807\u51c6\u4e0a\u5168\u9762\u652f\u6301 Ingress \u4e0e Gateway API\uff0c\u79ef\u6781\u62e5\u62b1\u4e91\u539f\u751f\u4e0b\u7684\u6807\u51c6 API \u89c4\u8303\uff1b\u540c\u65f6\uff0cHigress Controller \u4e5f\u652f\u6301 Nginx Ingress \u5e73\u6ed1\u8fc1\u79fb\uff0c\u5e2e\u52a9\u7528\u6237\u96f6\u6210\u672c\u5feb\u901f\u8fc1\u79fb\u5230 Higress\u3002\nHigress \u63d0\u4f9b\u4e86\u4e00\u5957 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/alibaba/higress/tree/main/plugins"},"Wasm (WebAssembly) SDK"),"\uff0c\u4f7f\u5f97\u5f00\u53d1\u8005\u80fd\u591f\u8f7b\u677e\u4f7f\u7528 C++\uff0cGolang\uff0cRust \u5f00\u53d1 Wasm \u63d2\u4ef6\u589e\u5f3a\u7f51\u5173\u80fd\u529b\u3002\u4e0b\u9762\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd Higress Transformer \u63d2\u4ef6\u7684\u57fa\u672c\u529f\u80fd\uff0c\u6700\u540e\u7b80\u5355\u8bf4\u660e Transformer \u63d2\u4ef6\u7684\u6838\u5fc3\u4ee3\u7801\u903b\u8f91\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://github.com/higress-group/higress-group.github.io/assets/49450531/c93bc55d-8cca-47ac-8b63-64168626f9a9",alt:"Higress Architecture"})),(0,a.kt)("h1",{id:"4-transformer-\u63d2\u4ef6\u4ecb\u7ecd"},"4. Transformer \u63d2\u4ef6\u4ecb\u7ecd"),(0,a.kt)("p",null,"Higress Transformer \u63d2\u4ef6\u53ef\u4ee5\u5bf9\u8bf7\u6c42/\u54cd\u5e94\u5934\u90e8\u3001\u8bf7\u6c42\u67e5\u8be2\u53c2\u6570\u3001\u8bf7\u6c42/\u54cd\u5e94\u4f53\u53c2\u6570\u8fdb\u884c\u8f6c\u6362\uff0c\u652f\u6301\u7684\u8f6c\u6362\u64cd\u4f5c\u7c7b\u578b\u5305\u62ec\u5220\u9664\uff08remove\uff09\u3001\u91cd\u547d\u540d\uff08rename\uff09\u3001\u66f4\u65b0\uff08replace\uff09\u3001\u6dfb\u52a0\uff08add\uff09\u3001\u8ffd\u52a0\uff08append\uff09\u3001\u6620\u5c04\uff08map\uff09\u548c\u53bb\u91cd\uff08dedupe\uff09\u3002"),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u590d\u73b0\u6700\u5f00\u59cb\u63d0\u5230\u7684 SCG GatewayFilter \u7b80\u5355\u7528\u4f8b\uff0c\u6765\u6f14\u793a\u5982\u4f55\u4f7f\u7528\u8be5\u63d2\u4ef6\uff08\u4ee5\u4e0b\u4f7f\u7528 Higress \u63a7\u5236\u53f0\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u90e8\u7f72\u63d2\u4ef6\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/higress-group/higress-demo/tree/main/wasm-demo/wasm-plugin-transformer"},"K8s YAML Manifests \u7684\u65b9\u5f0f"),"\uff09\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u9996\u5148\u6839\u636e",(0,a.kt)("a",{parentName:"li",href:"https://higress.io/zh-cn/docs/user/quickstart"},"\u5b98\u65b9\u6587\u6863")," \u5feb\u901f\u5b89\u88c5 Higress\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl -n higress-system get deploy\nNAME                         READY   UP-TO-DATE   AVAILABLE   AGE\nhigress-console              1/1     1            1           1d\nhigress-console-grafana      1/1     1            1           1d\nhigress-console-prometheus   1/1     1            1           1d\nhigress-controller           1/1     1            1           1d\nhigress-gateway              1/1     1            1           1d\n")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"\u901a\u8fc7 Higress \u63a7\u5236\u53f0\u6dfb\u52a0\u57df\u540d\uff08foo.bar.com\uff09\u3001\u8def\u7531\u914d\u7f6e\uff08foo\uff09\uff0c\u5c06\u6d41\u91cf\u8f6c\u53d1\u81f3\u540e\u7aef\u7684 ",(0,a.kt)("a",{parentName:"li",href:"https://httpbin.org/"},"httpbin")," \u670d\u52a1\uff1a")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://github.com/higress-group/higress-group.github.io/assets/49450531/4a6b2ed0-f42b-4ffa-8b36-99f7444a9e5f",alt:"image"})),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://github.com/higress-group/higress-group.github.io/assets/49450531/151442fd-b43a-40e3-8fcf-7afa49f69af9",alt:"image"})),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"\u4e3a foo \u8def\u7531\u6dfb\u52a0 Transformer \u63d2\u4ef6\uff08\u5f53\u524d\u672a\u63a8\u9001\u63d2\u4ef6\u81f3\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\uff0c\u53ef\u4ee5\u5148\u4f7f\u7528 docker.io/weixinx/transformer:v0.1.0\uff0c\u6216\u5230\u4ee3\u7801\u4ed3\u5e93\u81ea\u884c\u6784\u5efa\uff09\uff1a")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://github.com/higress-group/higress-group.github.io/assets/49450531/fb522095-ee88-4f77-89c2-8a8547a3a96f",alt:"image"})),(0,a.kt)("p",null,"\u6ce8\uff1a\u4e3a\u4e86\u80fd\u591f\u540c\u65f6\u5b8c\u6210\u8bf7\u6c42\u548c\u54cd\u5e94\u8f6c\u6362\u7684\u9700\u6c42\uff0c\u6211\u4eec\u9700\u8981\u4e3a foo \u8def\u7531\u518d\u6dfb\u52a0\u4e00\u4e2a Transformer \u63d2\u4ef6\uff0c\u547d\u540d\u4e3a transformer-resp\uff0c\u7528\u4e8e\u5904\u7406\u54cd\u5e94\u65b9\u5411\u3002"),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},"\u6dfb\u52a0 Transformer \u914d\u7f6e\u5e76\u5f00\u542f\u8be5\u63d2\u4ef6\uff1a")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'\u6dfb\u52a0\u8bf7\u6c42\u5934\u90e8 X-First\uff0c\u503c\u4ece\u8bf7\u6c42\u8def\u5f84\u4e2d\u83b7\u53d6\uff0c\u4f8b\u5982\u4ece /response-headers?testKey=testValue \u4e2d\u83b7\u53d6 "response-headers"\uff1b'),(0,a.kt)("li",{parentName:"ul"},"\u5c06\u8bf7\u6c42\u5934\u90e8 X-First \u7684\u503c\u6620\u5c04\u7ed9 X-Second\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u6dfb\u52a0\u8bf7\u6c42\u67e5\u8be2\u53c2\u6570 k1=v1\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u5254\u9664\u91cd\u590d\u7684\u54cd\u5e94\u5934\u90e8 X-Dedupe\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# transformer:\ntype: request  # \u6307\u5b9a Transformer \u7c7b\u578b\nrules:         # \u6307\u5b9a\u8f6c\u6362\u89c4\u5219\n- operate: add # \u6307\u5b9a\u8f6c\u6362\u64cd\u4f5c\u7c7b\u578b\n  headers:     # \u6307\u5b9a\u5934\u90e8\u8f6c\u6362\u89c4\u5219\n  - key: X-First\n    value: $1  # \u6b63\u5219\u8868\u8fbe\u5f0f\u6355\u83b7\u7ec4 $1\uff0c\u652f\u6301 RE2 \u8bed\u6cd5\n    path_pattern: ^\\/(\\w+)[\\?]{0,1}.*$\n  querys:      # \u6307\u5b9a\u67e5\u8be2\u53c2\u6570\u8f6c\u6362\u89c4\u5219\n  - key: k1\n    value: v1\n- operate: map\n  headers:\n  - key: X-First\n    value: X-Second\n---\n# transformer-resp:\ntype: response\nrules:\n- operate: dedupe\n  headers:\n  - key: X-Dedupe\n    value: RETAIN_FIRST\n")),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},"\u53d1\u9001\u8bf7\u6c42\u8fdb\u884c\u6d4b\u8bd5\uff1a")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'# \u9a8c\u8bc1\u8bf7\u6c42\u65b9\u5411\u8f6c\u6362\n$ curl -v -H "host: foo.bar.com" "127.0.0.1/get"\n...\n>\n< HTTP/1.1 200 OK\n...\n<\n{\n  "args": {\n    # \u6dfb\u52a0\u4e86\u67e5\u8be2\u53c2\u6570 k1=v1\n    "k1": "v1"\n  },\n  "headers": {\n    ...\n    "X-First": "get", # \u6dfb\u52a0\u4e86\u8bf7\u6c42\u5934\u90e8 X-First\uff0c\u503c "get" \u6765\u81ea\u8bf7\u6c42\u8def\u5f84\n    "X-Second": "get" # \u6620\u5c04\u4e86\u8bf7\u6c42\u5934\u90e8 X-Second\n  },\n  ...\n  # \u6dfb\u52a0\u4e86\u67e5\u8be2\u53c2\u6570 k1=v1\n  "url": "http://foo.bar.com/get?k1=v1"\n}\n\n\n# \u9a8c\u8bc1\u54cd\u5e94\u65b9\u5411\u8f6c\u6362\n$ curl -v -H "host: foo.bar.com" \\\n"127.0.0.1/response-headers?X-Dedupe=1&X-Dedupe=2&X-Dedupe=3"\n...\n>\n< HTTP/1.1 200 OK\n< x-dedupe: 1 # \u4fdd\u7559\u4e86\u54cd\u5e94\u5934\u90e8 X-Dedupe \u7684\u7b2c\u4e00\u4e2a\u503c\n...\n<\n{\n  ...\n  # \u901a\u8fc7\u67e5\u8be2\u53c2\u6570\u4f20\u7ed9 httpbin \u7684\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934\u90e8\n  "X-Dedupe": [\n    "1",\n    "2",\n    "3"\n  ],\n  ...\n}\n\n')),(0,a.kt)("p",null,"\u2757\ufe0f\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e0e\u4e0a\u8ff0\u4f8b\u5b50\u76f8\u540c\uff0c\u82e5\u6709\u540c\u65f6\u5904\u7406\u8bf7\u6c42\u548c\u54cd\u5e94\u8f6c\u6362\u7684\u9700\u6c42\uff0c\u5219\u9700\u8981\u4e3a\u76f8\u5e94\u8def\u7531\u6dfb\u52a0\u4e24\u4e2a Transformer \u63d2\u4ef6\uff0c\u5206\u522b\u5904\u7406\u8bf7\u6c42\u65b9\u5411\u548c\u54cd\u5e94\u65b9\u5411\uff08\u6b63\u5728\u4f18\u5316\uff09\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u8bf7\u6c42\u4f53\u652f\u6301\u7684 Content-Type \u6709\uff1aapplication/json, application/x-www-form-urlencoded, multipart/form-data\uff1b\u800c\u54cd\u5e94\u4f53\u4ec5\u652f\u6301 application/json\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u66f4\u591a\u8bf4\u660e\u8be6\u89c1",(0,a.kt)("a",{parentName:"li",href:"https://github.com/alibaba/higress/tree/main/plugins/wasm-go/extensions/transformer"},"\u63d2\u4ef6\u6587\u6863"),"\u3002")),(0,a.kt)("h1",{id:"5-transformer-\u903b\u8f91"},"5. Transformer \u903b\u8f91"),(0,a.kt)("p",null,"\u672c\u8282\u5c06\u7b80\u5355\u8bf4\u660e Higress Transformer \u63d2\u4ef6\u7684\u6838\u5fc3\u4ee3\u7801\u903b\u8f91\uff0c\u5e0c\u671b\u53ef\u4ee5\u4e3a\u6709\u5174\u8da3\u4f18\u5316\u8be5\u63d2\u4ef6\u6216\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\u7684\u540c\u5b66\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002"),(0,a.kt)("p",null,"\u9996\u5148\u8be5\u63d2\u4ef6\u4ee3\u7801\u4f4d\u4e8eHigress \u4ed3\u5e93\u7684 plugins/wasm-go/extensions/transformer \u76ee\u5f55\u4e0b\uff0c\u4f7f\u7528 Higress \u63d0\u4f9b\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/alibaba/higress/tree/main/plugins"},"Wasm SDK")," \u8fdb\u884c\u5f00\u53d1\uff08\u5173\u4e8e\u5982\u4f55\u5f00\u53d1 Wasm \u63d2\u4ef6\u8be6\u89c1",(0,a.kt)("a",{parentName:"p",href:"https://higress.io/zh-cn/docs/user/wasm-go"},"\u5b98\u65b9\u6587\u6863"),"\uff09\u3002"),(0,a.kt)("p",null,"\u63d2\u4ef6\u7684\u914d\u7f6e\u6a21\u578b TransformerConfig\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"# \u6a21\u578b\u4ee5\u63d2\u4ef6\u914d\u7f6e\u7684\u5f62\u5f0f\u66b4\u9732\u7ed9\u7528\u6237\ntype TransformerConfig struct {\n  typ   string          # Transformer \u7c7b\u578b\uff0c[request, response]\n  rules []TransformRule # \u8f6c\u6362\u89c4\u5219\n  \n  trans Transformer # Transformer \u5b9e\u4f8b\uff0c\u4e0d\u5bf9\u7528\u6237\u66b4\u9732\u914d\u7f6e\uff0c\u7528\u4e8e\u5b9e\u9645\u7684\u8f6c\u6362\u64cd\u4f5c\n}\n\ntype TransformRule struct {\n  operate string   # \u8f6c\u6362\u64cd\u4f5c\u7c7b\u578b\n  headers []Param  # header \u53c2\u6570 \n  querys  []Param  # query \u53c2\u6570\n  body    []Param  # body \u53c2\u6570\n}\n\ntype Param struct {\n  key         string # \u8868\u793a\u5b57\u6bb5\u7684 key\n  value       string # \u8868\u793a\u5b57\u6bb5\u7684 value \u6216 key (map) \u6216 strategy (dedupe)\n  valueType   string # \u4e3a application/json body \u6307\u5b9a value \u7684\u6570\u636e\u7c7b\u578b\n  hostPattern string # host \u6b63\u5219\u5339\u914d\u6a21\u5f0f\n  pathPattern string # path \u6b63\u5219\u5339\u914d\u6a21\u5f0f\n}\n")),(0,a.kt)("p",null,"\u5176\u4e2d Transformer \u4f5c\u4e3a\u63a5\u53e3\u5206\u522b\u6709\u8bf7\u6c42\u548c\u54cd\u5e94\u4e24\u4e2a\u5b9e\u73b0\uff08requestTransformer, responseTransformer\uff09\uff0c\u4e3b\u8981\u5b9e\u73b0\u4e86 3 \u4e2a\u63a5\u53e3\u65b9\u6cd5 TransformHeaders,TransformerQuerys \u548c TransformBody\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"type Transformer interface {\n TransformHeaders(host, path string, hs map[string][]string) error\n TransformQuerys(host, path string, qs map[string][]string) error\n TransformBody(host, path string, body interface{}) error\n ...\n}\n\nvar _ Transformer = (*requestTransformer)(nil)\nvar _ Transformer = (*responseTransformer)(nil)\n")),(0,a.kt)("p",null,"\u7531\u4e8e\u5934\u90e8\uff08Headers\uff09\u548c\u67e5\u8be2\u53c2\u6570\uff08Querys\uff09\u90fd\u662f\u4ee5 key-value \u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u56e0\u6b64\u901a\u8fc7 kvHandler \u5bf9\u4e24\u8005\u91c7\u7528\u7edf\u4e00\u7684\u5904\u7406\u903b\u8f91\uff1b\u800c Body \u7531\u4e8e\u8bf7\u6c42\u3001\u54cd\u5e94\u652f\u6301\u4e0d\u540c\u7684 Content-Type\uff0c\u56e0\u6b64\u5206\u522b\u901a\u8fc7 requestBodyHandler (kvHandler, jsonHandler \u7ec4\u5408)\u548c responseBodyHandler (jsonHandler) \u8fdb\u884c\u5904\u7406\u3002\u7efc\u4e0a\uff0c\u5728\u4fee\u6539\u8be5\u63d2\u4ef6\u903b\u8f91\u65f6\uff0c\u4e3b\u8981\u5bf9 kvHandler \u548c jsonHandler \u8fdb\u884c\u4fee\u6539\u5373\u53ef\uff0c\u5176\u4e2d jsonHandler \u4f9d\u8d56 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/tidwall/gjson"},"GJSON")," \u548c ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/tidwall/sjson"},"SJSON")," \u5de5\u5177\u5e93\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://github.com/higress-group/higress-group.github.io/assets/49450531/fc08ff0c-12ec-4dfd-b946-4e83f8431174",alt:"image"})),(0,a.kt)("p",null,"\u76ee\u524d handler \u4e2d\u7684\u8f6c\u6362\u987a\u5e8f\u662f\u88ab\u786c\u7f16\u7801\u7684\uff08remove -> rename -> replace -> add -> append -> map -> dedupe\uff09\uff0c\u6211\u4eec\u5bf9\u6b64\u6709\u4f18\u5316\u7684\u6253\u7b97\uff0c\u4e5f\u6b22\u8fce\u611f\u5174\u8da3\u7684\u540c\u5b66\u53c2\u4e0e\u8fdb\u6765 ~"),(0,a.kt)("h1",{id:"6-\u603b\u7ed3"},"6. \u603b\u7ed3"),(0,a.kt)("p",null,"\u672c\u6587\u5e26\u5927\u5bb6\u4e86\u89e3\u4e86 Higress Transformer \u63d2\u4ef6\uff0c\u5e76\u4e0e Spring Cloud Gateway \u8fdb\u884c\u4e86\u6027\u80fd\u6bd4\u8f83\uff0c\u5728\u6587\u7ae0\u7684\u6700\u540e\u8fd8\u8bf4\u660e\u4e86\u8be5\u63d2\u4ef6\u7684\u6838\u5fc3\u4ee3\u7801\u903b\u8f91\uff0c\u5e0c\u671b\u80fd\u591f\u4e3a\u5927\u5bb6\u4ece Spring Cloud Gateway \u8fc1\u79fb\u81f3 Higress \u63d0\u4f9b\u5e2e\u52a9\uff01"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://github.com/higress-group/higress-group.github.io/assets/49450531/c2a47afd-5f29-4cfc-b5c5-571d2265ec19",alt:"image"})),(0,a.kt)("p",null,"\u5982\u679c\u60a8\u89c9\u5f97 Higress \u5bf9\u60a8\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u524d\u5f80 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/alibaba/higress"},"Github: Higress")," \u4e3a\u6211\u4eec star\u2b50\ufe0f \u4e00\u4e0b\uff01\u671f\u5f85\u4e0e\u60a8\u5728 Higress \u793e\u533a\u76f8\u9047 ~"))}m.isMDXComponent=!0}}]);