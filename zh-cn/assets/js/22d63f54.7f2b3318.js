"use strict";(self.webpackChunkhigress_website=self.webpackChunkhigress_website||[]).push([[3975],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),p=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(o.Provider,{value:t},e.children)},u="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},k=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(n),k=a,m=u["".concat(o,".").concat(k)]||u[k]||g[k]||s;return n?r.createElement(m,l(l({ref:t},c),{},{components:n})):r.createElement(m,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,l=new Array(s);l[0]=k;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[u]="string"==typeof e?e:a,l[1]=i;for(var p=2;p<s;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}k.displayName="MDXCreateElement"},1495:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>g,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const s={title:"Higress \u96c6\u6210 Skywalking \u53ef\u89c2\u6d4b\u6027\u63a2\u7d22",keywords:["higress"],description:"Higress \u96c6\u6210 Skywalking \u53ef\u89c2\u6d4b\u6027\u63a2\u7d22",author:"Jun",date:new Date("2023-06-20T00:00:00.000Z"),custom_edit_url:"https://github.com/higress-group/higress-group.github.io/blob/main/i18n/zh-cn/docusaurus-plugin-content-blog/skywalking.md"},l="Higress \u96c6\u6210 Skywalking \u53ef\u89c2\u6d4b\u6027\u63a2\u7d22",i={permalink:"/zh-cn/blog/skywalking",editUrl:"https://github.com/higress-group/higress-group.github.io/blob/main/i18n/zh-cn/docusaurus-plugin-content-blog/skywalking.md",source:"@site/i18n/zh-cn/docusaurus-plugin-content-blog/skywalking.md",title:"Higress \u96c6\u6210 Skywalking \u53ef\u89c2\u6d4b\u6027\u63a2\u7d22",description:"Higress \u96c6\u6210 Skywalking \u53ef\u89c2\u6d4b\u6027\u63a2\u7d22",date:"2023-06-20T00:00:00.000Z",formattedDate:"2023\u5e746\u670820\u65e5",tags:[],readingTime:13.91,hasTruncateMarker:!1,authors:[{name:"Jun"}],frontMatter:{title:"Higress \u96c6\u6210 Skywalking \u53ef\u89c2\u6d4b\u6027\u63a2\u7d22",keywords:["higress"],description:"Higress \u96c6\u6210 Skywalking \u53ef\u89c2\u6d4b\u6027\u63a2\u7d22",author:"Jun",date:"2023-06-20T00:00:00.000Z",custom_edit_url:"https://github.com/higress-group/higress-group.github.io/blob/main/i18n/zh-cn/docusaurus-plugin-content-blog/skywalking.md"},prevItem:{title:"\u7f8e\u6d3d\u667a\u80fd\u5ba2\u670d\u4f7f\u7528 Higress \u7edf\u4e00\u7f51\u5173\u843d\u5730\u5b9e\u8df5",permalink:"/zh-cn/blog/user-mq"},nextItem:{title:"Higress \u5f00\u6e90\u4e4b\u590f\u9879\u76ee\u62a5\u540d",permalink:"/zh-cn/blog/ospp-2023"}},o={authorsImageUrls:[void 0]},p=[{value:"\u4e00\u3001\u6574\u4f53\u67b6\u6784\u56fe",id:"\u4e00\u6574\u4f53\u67b6\u6784\u56fe",level:2},{value:"\u4e8c\u3001Skywalking \u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u539f\u7406",id:"\u4e8cskywalking-\u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u539f\u7406",level:2},{value:"Skywalking \u6574\u4f53\u67b6\u6784",id:"skywalking-\u6574\u4f53\u67b6\u6784",level:3},{value:"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u539f\u7406\u5206\u6790",id:"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u539f\u7406\u5206\u6790",level:3},{value:"\u4e09\u3001Higress \u67b6\u6784",id:"\u4e09higress-\u67b6\u6784",level:2},{value:"\u56db\u3001\u4e1a\u52a1\u5e94\u7528\u96c6\u6210 Skywalking",id:"\u56db\u4e1a\u52a1\u5e94\u7528\u96c6\u6210-skywalking",level:2},{value:"\u4e94\u3001\u672c\u5730\u6d4b\u8bd5\u73af\u5883\u642d\u5efa",id:"\u4e94\u672c\u5730\u6d4b\u8bd5\u73af\u5883\u642d\u5efa",level:2},{value:"\u516d\u3001Higress \u96c6\u6210 Skywalking \u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u914d\u7f6e",id:"\u516dhigress-\u96c6\u6210-skywalking-\u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u914d\u7f6e",level:2},{value:"\u4e03\u3001Skywalking \u94fe\u8def\u8ddf\u8e2a",id:"\u4e03skywalking-\u94fe\u8def\u8ddf\u8e2a",level:2},{value:"\u8fd0\u884c\u538b\u6d4b\u811a\u672c",id:"\u8fd0\u884c\u538b\u6d4b\u811a\u672c",level:3},{value:"\u8c03\u7528 bff \u670d\u52a1 /service \u63a5\u53e3\u6765\u6a21\u62df\u8c03\u7528\u94fe\u8def",id:"\u8c03\u7528-bff-\u670d\u52a1-service-\u63a5\u53e3\u6765\u6a21\u62df\u8c03\u7528\u94fe\u8def",level:3},{value:"\u516b\u3001Higress gateway \u6307\u6807\u548c\u76d1\u63a7\u9762\u677f",id:"\u516bhigress-gateway-\u6307\u6807\u548c\u76d1\u63a7\u9762\u677f",level:2},{value:"\u53c2\u8003\u6587\u6863",id:"\u53c2\u8003\u6587\u6863",level:2}],c={toc:p},u="wrapper";function g(e){let{components:t,...s}=e;return(0,a.kt)(u,(0,r.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://higress.io/zh-cn/"},"Higress")," \u4e00\u4e2a\u9075\u5faa\u5f00\u6e90Ingress/Gateway API\u6807\u51c6\uff0c\u63d0\u4f9b\u6d41\u91cf\u8c03\u5ea6\u3001\u670d\u52a1\u6cbb\u7406\u3001\u5b89\u5168\u9632\u62a4\u4e09\u5408\u4e00\u7684\u9ad8\u96c6\u6210\u3001\u6613\u4f7f\u7528\u3001\u6613\u6269\u5c55\u3001\u70ed\u66f4\u65b0\u7684\u4e0b\u4e00\u4ee3\u4e91\u539f\u751f\u7f51\u5173\u3002"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://skywalking.apache.org/"},"Skywalking")," \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u53ef\u89c2\u6d4b\u5e73\u53f0\uff0c\u7528\u4e8e\u4ece\u670d\u52a1\u548c\u4e91\u539f\u751f\u57fa\u7840\u8bbe\u65bd\u6536\u96c6\uff0c\u5206\u6790\uff0c \u805a\u5408\u53ca\u53ef\u89c6\u5316\u6570\u636e\u3002"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/2456868764/httpbin"},"Httpbin")," \u662f\u57fa\u4e8e Gin \u5f00\u53d1\uff0c\u7528\u4e8e\u5feb\u901f\u6d4b\u8bd5\u57fa\u4e8e\u4e91\u539f\u751f\u5fae\u670d\u52a1\u53ef\u89c2\u6d4b\u6027\u548c\u6d41\u91cf\u7ba1\u7406\u7b49\u529f\u80fd\u3002"),(0,a.kt)("p",null,"\u672c\u6587\u4ecb\u7ecd Higress \u96c6\u6210 Skywalking \u5b9e\u73b0\u53ef\u89c2\u6d4b\u6027\uff0c\u4e3b\u8981\u5185\u5bb9\u6d89\u53ca\u6574\u4f53\u67b6\u6784\u3001Skywalking \u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u539f\u7406\u3001Higress \u67b6\u6784\u3001\u4e1a\u52a1\u5e94\u7528\u96c6\u6210 Skywalking\u3001\u672c\u5730\u6d4b\u8bd5\u73af\u5883\u642d\u5efa\u3001Higress \u914d\u7f6e\u3001\u5e94\u7528\u5b89\u88c5\u3001\u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u914d\u7f6e\u4ee5\u53ca Higress gateway \u6307\u6807\u548c\u76d1\u63a7\u9762\u677f\u3002"),(0,a.kt)("p",null,"\u8fd9\u6b21\u53ef\u89c2\u6d4b\u6027\u63a2\u7d22\u76f8\u5173 manifests ",(0,a.kt)("a",{parentName:"p",href:"https://gitcode.net/-/snippets/3612"},"\u4e0b\u8f7d\u5730\u5740")," "),(0,a.kt)("h2",{id:"\u4e00\u6574\u4f53\u67b6\u6784\u56fe"},"\u4e00\u3001\u6574\u4f53\u67b6\u6784\u56fe"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(4225).Z,width:"2855",height:"1318"})),(0,a.kt)("p",null,"\u6574\u4f53\u5305\u542b\u56db\u5927\u5757\u5185\u5bb9\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Higress \u7ec4\u4ef6\uff1a    higress-gateway, higress-console, higress-controller"),(0,a.kt)("li",{parentName:"ul"},"Skywalking \u7ec4\u4ef6\uff1a skywalking dashboard ui, skywalking aop server"),(0,a.kt)("li",{parentName:"ul"},"\u4e1a\u52a1\u5e94\u7528\u7ec4\u4ef6\uff1a      bff, middle service, backend service"),(0,a.kt)("li",{parentName:"ul"},"Ingress \u7ec4\u4ef6\uff1a    console.higress.io, skywalking.higress.io, httpbin.example.com")),(0,a.kt)("h2",{id:"\u4e8cskywalking-\u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u539f\u7406"},"\u4e8c\u3001Skywalking \u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u539f\u7406"),(0,a.kt)("p",null,"SkyWalking\u4e3a\u670d\u52a1(service)\uff0c\u670d\u52a1\u5b9e\u4f8b(service instance)\uff0c\u4ee5\u53ca\u7aef\u70b9(endpoint)\u63d0\u4f9b\u4e86\u53ef\u89c2\u6d4b\u80fd\u529b\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1(service)\uff1a\u8868\u793a\u5bf9\u8bf7\u6c42\u63d0\u4f9b\u76f8\u540c\u884c\u4e3a\u7684\u4e00\u7ec4\u5de5\u4f5c\u8d1f\u8f7d\u3002\u5728\u4f7f\u7528\u6253\u70b9\u4ee3\u7406\u6216 SDK \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4e49\u670d\u52a1\u7684\u540d\u5b57\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5b9e\u4f8b(Service Instance)\uff1a\u4e00\u7ec4\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u79f0\u4e3a\u4e00\u4e2a\u5b9e\u4f8b\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u7aef\u70b9(Endpoint)\uff1a \u5bf9\u4e8e\u7279\u5b9a\u670d\u52a1\u6240\u63a5\u6536\u7684\u8bf7\u6c42\u8def\u5f84\uff0c\u5982 HTTP \u7684 URI \u8def\u5f84\u548c gRPC \u670d\u52a1\u7684\u7c7b\u540d + \u65b9\u6cd5\u7b7e\u540d\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\uff08Process\uff09\uff1a \u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0b. \u5728\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c\u4e00\u4e2a\u670d\u52a1\u5b9e\u4f8b\u548c\u8fdb\u7a0b\u4e0d\u662f\u4e00\u4e00\u5bf9\u5e94\uff0c \u5728k8s\u90e8\u7f72\u4e0b\uff0c\u4e00\u4e2aPOD\u5bf9\u5e94\u591a\u4e2a\u8fdb\u7a0b\u3002")),(0,a.kt)("h3",{id:"skywalking-\u6574\u4f53\u67b6\u6784"},"Skywalking \u6574\u4f53\u67b6\u6784"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(3764).Z,width:"2160",height:"721"})),(0,a.kt)("p",null,"\u4e3b\u8981\u7531\u56db\u4e2a\u6838\u5fc3\u7ec4\u4ef6\u7ec4\u6210\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u63a2\u9488: \u63a2\u9488\u7528\u4e8e\u6536\u96c6\u76d1\u6d4b\u6570\u636e\u5305\u62ec\u6307\u6807\uff0c\u94fe\u8def\u8ddf\u8e2a\uff0c\u65e5\u5fd7\u548c\u4e8b\u4ef6"),(0,a.kt)("li",{parentName:"ul"},"\u6570\u636e\u63a5\u6536\u548c\u805a\u5408: \u5e73\u53f0\u540e\u7aef\u652f\u6301\u6570\u636e\u805a\u5408\uff0c\u6570\u636e\u5206\u6790\u4ee5\u53ca\u9a71\u52a8\u6570\u636e\u6d41\u4ece\u63a2\u9488\u5230\u7528\u6237\u754c\u9762\u7684\u5904\u7406"),(0,a.kt)("li",{parentName:"ul"},"\u5b58\u50a8: \u901a\u8fc7\u5f00\u653e\u63a5\u53e3\u652f\u6301\u540e\u7aef\u5b58\u50a8\u7cfb\u7edf\u652f\u6301ElasticSearch, H2, MySQL, TiDB, BanyanDB\u7b49"),(0,a.kt)("li",{parentName:"ul"},"UI:  \u4e00\u4e2a\u5b9a\u5236\u5316\u7684Web\u7cfb\u7edf\uff0c\u7528\u6237\u53ef\u4ee5\u53ef\u89c6\u5316\u67e5\u770b\u548c\u7ba1\u7406 SkyWalking \u6570\u636e")),(0,a.kt)("h3",{id:"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u539f\u7406\u5206\u6790"},"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u539f\u7406\u5206\u6790"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5206\u5e03\u5f0f\u94fe\u8def\u4ecb\u7ecd")),(0,a.kt)("p",null,"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u662f\u8bb0\u5f55\u6765\u6e90\u4e8e\u7528\u6237\u8bf7\u6c42\u5728\u5404\u4e2a\u7cfb\u7edf\u6216\u8005\u670d\u52a1\u4e2d\u6240\u4f20\u64ad\u7684\u8def\u5f84\u3002"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"A distributed trace, more commonly known as a trace, records the paths taken by requests (made by an application or end-user) as they propagate through multi-service architectures, like microservice and serverless applications.")),(0,a.kt)("p",null,"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u56fe\u793a\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(5506).Z,width:"910",height:"240"})),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"Skywalking \u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a")),(0,a.kt)("p",null,"\u4e3b\u8981\u5305\u542b\u56db\u4e2a\u5185\u5bb9\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Trace: \u4e00\u4e2a\u5b8c\u6574\u7684\u94fe\u8def\u7531\u591a\u4e2a Segment \u7ec4\u6210"),(0,a.kt)("li",{parentName:"ul"},"Segment: \u4e00\u4e2a\u8bf7\u6c42\u5728\u4e00\u4e2a\u8fdb\u7a0b\u5185\u7684\u8f68\u8ff9"),(0,a.kt)("li",{parentName:"ul"},"Span: \u4e00\u4e2a\u8bf7\u6c42\u5728\u67d0\u4e2a\u8fdb\u7a0b\u91cc\u7684\u4e00\u4e2a\u7ec4\u4ef6\u903b\u8f91\u5185\u7684\u8f68\u8ff9, \u6709 Entry Span\uff0c Local Span \u548c Exit Span \u4e09\u7c7b"),(0,a.kt)("li",{parentName:"ul"},"Span context: \u8de8\u8fdb\u7a0b\u6216\u8005\u670d\u52a1 Trace \u4f20\u9012\uff0c\u8fd9\u91cc\u8ba8\u8bba http \u4f20\u9012\u5934 sw8")),(0,a.kt)("p",null,"\u57fa\u672c\u7ec4\u4ef6\u56fe\u793a\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(885).Z,width:"2370",height:"929"})),(0,a.kt)("p",null,"\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e00\u4e2a Trace \u5185\u7684\u6240\u6709 span \u7684 Trace ID \u662f\u76f8\u540c\u7684"),(0,a.kt)("li",{parentName:"ul"},"\u4e00\u4e2a Segment \u4e2d\u6709\u4e00\u4e2a EntrySpan\uff0c\u662f Segment \u5185\u5176\u4ed6 Span \u7684\u6839 Parent"),(0,a.kt)("li",{parentName:"ul"},"\u540e\u4e00\u4e2a Segment\u7684 Entryspan \u603b\u662f\u4e0e\u524d\u4e00\u4e2a Segment \u4e2d\u7684\u67d0\u4e2a ExitSpan \u5173\u8054")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"Skywalking Trace \u7684\u6570\u636e\u534f\u8bae")),(0,a.kt)("p",null,"\u5177\u4f53\u6570\u636e\u534f\u8bae\u53c2\u8003 ",(0,a.kt)("a",{parentName:"p",href:"https://skywalking.apache.org/docs/main/next/en/api/trace-data-protocol-v3/"},"Skywalking Trace Data Protocol"),", \u8fd9\u91cc\u4e3b\u8981\u8bb2\u4e00\u4e0b sw8 \u683c\u5f0f\u548c\u7ec4\u6210\u3002"),(0,a.kt)("p",null,"sw8 \u683c\u5f0f: XXXXX-XXXXX-XXXX-XXXX\uff0c\u4ee5 - \u5206\u5272\u3002\n\u6837\u4f8b: 1-MzYzMzM1NDctNTc0YS00MzZlLTgzNWEtNTY1YTQyNzk3YTY3-ZWQ3ODA2ZjYwNTI0MTFlZWE5ZDdmZTFhNTA5YTRmYTk=-1-bWlkZGxl-bWlkZGxlLTZmNGRkN2JmNmMtcWJ4cm0=-L0dFVC9zZXJ2aWNl-aHR0cDovL2JhY2tlbmQv"),(0,a.kt)("p",null,"\u5177\u4f53\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u91c7\u6837\u6807\u8bb0(Sample):  0 \u6216\u8005 1\uff0c 0 \u8868\u793a\u4e0d\u91c7\u6837 1 \u8868\u793a\u91c7\u6837"),(0,a.kt)("li",{parentName:"ul"},"\u8ddf\u8e2aID(Trace ID): \u5b57\u7b26(BASE64 \u7f16\u7801)"),(0,a.kt)("li",{parentName:"ul"},"\u7236Sengment ID (Parent trace segment ID): \u5b57\u7b26(BASE64 \u7f16\u7801)"),(0,a.kt)("li",{parentName:"ul"},"\u7236 Span ID\uff08Parent span ID): \u6574\u578b"),(0,a.kt)("li",{parentName:"ul"},"\u7236\u670d\u52a1\u540d\u79f0(Parent service): \u5b57\u7b26(BASE64 \u7f16\u7801)"),(0,a.kt)("li",{parentName:"ul"},"\u7236\u670d\u52a1\u5b9e\u4f8b(Parent service instance): \u5b57\u7b26(BASE64 \u7f16\u7801)"),(0,a.kt)("li",{parentName:"ul"},"\u7236Endpoint(Parent endpoint): \u5b57\u7b26(BASE64 \u7f16\u7801)"),(0,a.kt)("li",{parentName:"ul"},"\u76ee\u6807\u5730\u5740\uff1a\u5b57\u7b26(BASE64 \u7f16\u7801)")),(0,a.kt)("h2",{id:"\u4e09higress-\u67b6\u6784"},"\u4e09\u3001Higress \u67b6\u6784"),(0,a.kt)("p",null,"Higress\u662f\u57fa\u4e8e\u963f\u91cc\u5185\u90e8\u7684Envoy Gateway\u5b9e\u8df5\u6c89\u6dc0\u3001\u4ee5\u5f00\u6e90 Istio + Envoy \u4e3a\u6838\u5fc3\u6784\u5efa\u7684\u4e0b\u4e00\u4ee3\u4e91\u539f\u751f\u7f51\u5173\uff0c\u5b9e\u73b0\u4e86\u6d41\u91cf\u7f51\u5173 + \u5fae\u670d\u52a1\u7f51\u5173 + \u5b89\u5168\u7f51\u5173\u4e09\u5408\u4e00\u7684\u9ad8\u96c6\u6210\u80fd\u529b\uff0c\u6df1\u5ea6\u96c6\u6210Dubbo\u3001Nacos\u3001Sentinel\u7b49\u5fae\u670d\u52a1\u6280\u672f\u6808\uff0c\u80fd\u591f\u5e2e\u52a9\u7528\u6237\u6781\u5927\u7684\u964d\u4f4e\u7f51\u5173\u7684\u90e8\u7f72\u53ca\u8fd0\u7ef4\u6210\u672c\u4e14\u80fd\u529b\u4e0d\u6253\u6298\uff1b"),(0,a.kt)("p",null,"\u5728\u6807\u51c6\u4e0a\u5168\u9762\u652f\u6301 Ingress\u4e0e Gateway API\uff0c\u79ef\u6781\u62e5\u62b1\u4e91\u539f\u751f\u4e0b\u7684\u6807\u51c6API\u89c4\u8303\uff1b"),(0,a.kt)("p",null,"\u540c\u65f6\uff0cHigress Controller\u4e5f\u652f\u6301Nginx Ingress\u5e73\u6ed1\u8fc1\u79fb\uff0c\u5e2e\u52a9\u7528\u6237\u96f6\u6210\u672c\u5feb\u901f\u8fc1\u79fb\u5230Higress\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(716).Z,width:"2483",height:"2024"})),(0,a.kt)("h2",{id:"\u56db\u4e1a\u52a1\u5e94\u7528\u96c6\u6210-skywalking"},"\u56db\u3001\u4e1a\u52a1\u5e94\u7528\u96c6\u6210 Skywalking"),(0,a.kt)("p",null,"\u4e1a\u52a1\u5e94\u7528\u901a\u8fc7\u4e0e ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/SkyAPM/go2sky"},"go2sky")," \u9879\u76ee\u96c6\u6210 SkyWalking \u76d1\u63a7 Golang \u5e94\u7528\u7a0b\u5e8f\uff0c\u4e3b\u8981\u901a\u8fc7 Gin middleware \u548c Http \u8bf7\u6c42\u624b\u52a8\u57cb\u70b9\u3002"),(0,a.kt)("p",null,"1\u3001\u96c6\u6210 Gin middleware"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-golang"},'func middleware(engine *gin.Engine, tracer *go2sky.Tracer) gin.HandlerFunc {\n    if engine == nil || tracer == nil {\n        return func(c *gin.Context) {\n            c.Next()\n        }\n    }\n    return func(c *gin.Context) {\n        if strings.HasPrefix(c.Request.URL.String(), skipProbPrefix) || strings.HasPrefix(c.Request.URL.String(), skipMetricsPrefix) {\n            c.Next()\n            return\n        }\n        span, ctx, err := tracer.CreateEntrySpan(c.Request.Context(), getOperationName(c), func(key string) (string, error) {\n            return c.Request.Header.Get(key), nil\n        })\n        if err != nil {\n            c.Next()\n            return\n        }\n        span.SetComponent(componentIDGINHttpServer)\n        span.Tag(go2sky.TagHTTPMethod, c.Request.Method)\n        span.Tag(go2sky.TagURL, c.Request.Host+c.Request.URL.Path)\n        span.SetSpanLayer(agentv3.SpanLayer_Http)\n\n        c.Request = c.Request.WithContext(ctx)\n\n        c.Next()\n\n        if len(c.Errors) > 0 {\n            span.Error(time.Now(), c.Errors.String())\n        }\n        span.Tag(go2sky.TagStatusCode, strconv.Itoa(c.Writer.Status()))\n        span.End()\n    }\n}\n\nfunc getOperationName(c *gin.Context) string {\n    return fmt.Sprintf("/%s%s", c.Request.Method, c.FullPath())\n}\n\n')),(0,a.kt)("p",null,"2\u3001Http\u8bf7\u6c42\u624b\u52a8\u57cb\u70b9"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-golang"},'func traceHttpCall(c *gin.Context, req *http.Request, url string, fn func(req *http.Request) (*http.Response, error)) (*http.Response, error) {\n    tracer := go2sky.GetGlobalTracer()\n    if tracer == nil {\n        resp, err := fn(req)\n        return resp, err\n    }\n\n    reqSpan, err := go2sky.GetGlobalTracer().CreateExitSpan(c.Request.Context(), "invoke", url, func(headerKey, headerValue string) error {\n        req.Header.Set(headerKey, headerValue)\n        return nil\n    })\n    \n    reqSpan.SetComponent(2)\n    reqSpan.SetSpanLayer(v3.SpanLayer_Http)\n    resp, err2 := fn(req)\n    reqSpan.Tag(go2sky.TagHTTPMethod, http.MethodGet)\n    reqSpan.Tag(go2sky.TagURL, url)\n    reqSpan.End()\n    return resp, err2\n\n}\n')),(0,a.kt)("h2",{id:"\u4e94\u672c\u5730\u6d4b\u8bd5\u73af\u5883\u642d\u5efa"},"\u4e94\u3001\u672c\u5730\u6d4b\u8bd5\u73af\u5883\u642d\u5efa"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u672c\u5730\u5b89\u88c5 kubectl, kind, helm")),(0,a.kt)("p",null,"\u53ef\u4ee5\u53c2\u8003 Higress ",(0,a.kt)("a",{parentName:"p",href:"https://higress.io/zh-cn/docs/user/quickstart"},"\u5feb\u901f\u5f00\u59cb"),"\u5b89\u88c5 kubectl, kind\u3002\nhelm \u5b89\u88c5\u53c2\u8003",(0,a.kt)("a",{parentName:"p",href:"https://helm.sh/zh/docs/intro/install/"},"\u5b89\u88c5\u6587\u6863")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"\u5b89\u88c5 higress \u548c istio CRD")),(0,a.kt)("p",null,"\u53ef\u4ee5\u53c2\u8003 higress ",(0,a.kt)("a",{parentName:"p",href:"https://higress.io/zh-cn/docs/user/quickstart"},"\u5feb\u901f\u5f00\u59cb")," \u548c ",(0,a.kt)("a",{parentName:"p",href:"https://higress.io/zh-cn/docs/ops/deploy-by-helm"},"\u5b89\u88c5\u90e8\u7f72")," \u6765\u90e8\u7f72\uff0c\u8fd9\u91cc\u9700\u8981\u5b89\u88c5  Istio CRD\u3002"),(0,a.kt)("p",null,"\u8fd9\u91cc\u63d0\u4f9b\u4e00\u952e\u5b89\u88c5\u811a\u672c local-env-setup.sh\uff0c\u8fd0\u884c local-env-setup.sh \u5b89\u88c5 Higress"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"./local-env-setup.sh --crd\n")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"\u90e8\u7f72 Skywalking\uff0c\u4e1a\u52a1\u5e94\u7528\u548c Ingress")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ export KUBECONFIG=${HOME}/.kube/config_higress\n$ kubectl apply -f skywalking.yaml\n$ kubectl apply -f app.yaml\n$ kubectl apply -f ingress.yaml\n")),(0,a.kt)("p",null,"\u68c0\u67e5 POD \u8fd0\u884c\u72b6\u6001\u548c Ingress \u72b6\u6001"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ export KUBECONFIG=${HOME}/.kube/config_higress\n\n$ kubectl get pods -n higress-system \n\nNAME                                         READY   STATUS    RESTARTS   AGE\nhigress-console-6f554978dc-cclg7             1/1     Running   0          100m\nhigress-console-grafana-7495766db4-4flq5     1/1     Running   0          131m\nhigress-console-prometheus-6d7bdccfb-hxtsq   1/1     Running   0          131m\nhigress-controller-689c5b965f-7wsmt          2/2     Running   0          131m\nhigress-gateway-59966b45d9-z7ltd             1/1     Running   0          131m\n\n$ kubectl get pods -n op-system\n\nNAME                                        READY   STATUS    RESTARTS   AGE\nskywalking-oap-dashboard-65f496ccc9-dr96l   1/1     Running   0          99m\nskywalking-oap-server-859694656b-p8vcq      1/1     Running   0          99m\n\n$ kubectl get pods -n app-system\n\nNAME                       READY   STATUS    RESTARTS   AGE\nbackend-6b9549bc64-f98tr   1/1     Running   0          99m\nbackend-6b9549bc64-x2btl   1/1     Running   0          99m\nbff-766967f8db-8ght7       1/1     Running   0          99m\nbff-766967f8db-gflbh       1/1     Running   0          99m\nmiddle-6f4dd7bf6c-qdjqj    1/1     Running   0          99m\nmiddle-6f4dd7bf6c-stzf4    1/1     Running   0          99m\n\n$ kubectl get svc -n app-system\n\nNAME      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\nbackend   ClusterIP   10.96.179.140   <none>        80/TCP    99m\nbff       ClusterIP   10.96.121.62    <none>        80/TCP    99m\nmiddle    ClusterIP   10.96.55.8      <none>        80/TCP    99m\n\n\n$ kubectl get ingress -n higress-system\n\nNAME                         CLASS     HOSTS                   ADDRESS   PORTS   AGE\nhigress-console              higress   console.higress.io                80      34m\nhigress-console-grafana      higress   console.higress.io                80      34m\nhigress-console-prometheus   higress   console.higress.io                80      34m\nhttpbin                      higress   httpbin.example.com               80      8s\nskywalking-dashboard         higress   skywalking.higress.io             80      8s\n")),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},"\u6d4b\u8bd5 Higress Console, Skywalking Dashboard, Bff \u670d\u52a1")),(0,a.kt)("p",null,"1\uff09\u7f16\u8f91 /etc/hosts \u6587\u4ef6\u6dfb\u52a0\u4ee5\u4e0b\u4e09\u4e2a\u57df\u540d"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"127.0.0.1 console.higress.io\n127.0.0.1 skywalking.higress.io\n127.0.0.1 httpbin.example.com\n")),(0,a.kt)("p",null,"2\uff09\u6253\u5f00 higress-gateway \u7aef\u53e3\u8f6c\u53d1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ export KUBECONFIG=${HOME}/.kube/config_higress\n$ kubectl -n higress-system port-forward service/higress-gateway 8080:80\n")),(0,a.kt)("p",null,"3\uff09\u901a\u8fc7\u6d4f\u89c8\u5668\u6253\u5f00\u8bbf\u95ee\u4e0a\u9762\u4e09\u4e2a\u57df\u540d"),(0,a.kt)("p",null,"Higress \u63a7\u5236\u53f0: ",(0,a.kt)("a",{parentName:"p",href:"http://console.higress.io:8080"},"http://console.higress.io:8080"),"\u3002\u9996\u6b21\u8bbf\u95ee\u63a7\u5236\u53f0\u65f6\u9700\u8981\u5148\u521d\u59cb\u5316\u7ba1\u7406\u5458\u7528\u6237\u3002\u521d\u59cb\u5316\u5b8c\u6210\u540e\u4f7f\u7528\u5bf9\u5e94\u7684\u7528\u6237\u540d\u5bc6\u7801\u767b\u5f55\u5373\u53ef\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(5297).Z,width:"2698",height:"1142"})),(0,a.kt)("p",null,"Skywalking Dashboard: ",(0,a.kt)("a",{parentName:"p",href:"http://skywalking.higress.io:8080"},"http://skywalking.higress.io:8080")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(8981).Z,width:"2814",height:"1420"})),(0,a.kt)("p",null,"Bff \u670d\u52a1\uff1a ",(0,a.kt)("a",{parentName:"p",href:"http://httpbin.example.com:8080/hostname"},"http://httpbin.example.com:8080/hostname")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(9502).Z,width:"2708",height:"1156"})),(0,a.kt)("h2",{id:"\u516dhigress-\u96c6\u6210-skywalking-\u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u914d\u7f6e"},"\u516d\u3001Higress \u96c6\u6210 Skywalking \u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u914d\u7f6e"),(0,a.kt)("p",null,"\u901a\u8fc7\u4fee\u6539 Higress configmap \u5168\u5c40\u914d\u7f6e higress-config \u6765\u6fc0\u6d3b Higress \u96c6\u6210 Skywalking \u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ export KUBECONFIG=${HOME}/.kube/config_higress\n$ kubectl edit configmap higgress-config -n higress-system\n")),(0,a.kt)("p",null,"\u5728 data \u4e0b\u589e\u52a0 higress \u914d\u7f6e\u9879\u7136\u540e\u4fdd\u5b58\uff0c\u5177\u4f53\u914d\u7f6e\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"data:\n  higress: |-\n    tracing:\n      enable: true\n      sampling: 100\n      timeout: 500\n      skywalking:\n       service: skywalking-oap-server.op-system.svc.cluster.local\n       port: 11800\n")),(0,a.kt)("h2",{id:"\u4e03skywalking-\u94fe\u8def\u8ddf\u8e2a"},"\u4e03\u3001Skywalking \u94fe\u8def\u8ddf\u8e2a"),(0,a.kt)("h3",{id:"\u8fd0\u884c\u538b\u6d4b\u811a\u672c"},"\u8fd0\u884c\u538b\u6d4b\u811a\u672c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'for i in $(seq 1 1000)\ndo\n    curl -v -H "Host:httpbin.example.com" http://127.0.0.1:8080/hostname\n    curl -v -H "Host:httpbin.example.com" http://127.0.0.1:8080/\n    curl -v -H "Host:httpbin.example.com" http://127.0.0.1:8080/service?services=middle,backend\ndone\n')),(0,a.kt)("h3",{id:"\u8c03\u7528-bff-\u670d\u52a1-service-\u63a5\u53e3\u6765\u6a21\u62df\u8c03\u7528\u94fe\u8def"},"\u8c03\u7528 bff \u670d\u52a1 /service \u63a5\u53e3\u6765\u6a21\u62df\u8c03\u7528\u94fe\u8def"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'curl -v -H "Host:httpbin.example.com" http://127.0.0.1:8080/service?services=middle,backend\n')),(0,a.kt)("p",null,"\u90e8\u5206\u8fd4\u56de\u54cd\u5e94\u4f53\u60c5\u51b5\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "args": {\n  },\n  "form": {\n  },\n  "headers": {\n    "accept-encoding": "gzip",\n    "sw8": "1-MzYzMzM1NDctNTc0YS00MzZlLTgzNWEtNTY1YTQyNzk3YTY3-ZWQ3ODA2ZjYwNTI0MTFlZWE5ZDdmZTFhNTA5YTRmYTk=-1-bWlkZGxl-bWlkZGxlLTZmNGRkN2JmNmMtcWJ4cm0=-L0dFVC9zZXJ2aWNl-aHR0cDovL2JhY2tlbmQv",\n    "sw8-correlation": "",\n    "user-agent": "Go-http-client/1.1",\n    "x-httpbin-trace-host": "bff-766967f8db-jwn2g/middle-6f4dd7bf6c-qbxrm/backend-6b9549bc64-8twnx",\n    "x-httpbin-trace-service": "bff/middle/backend",\n    "x-request-id": "e5a1b250-ebe3-931d-91d7-90e3ee2fc867"\n  },\n  "method": "GET",\n  "origin": "",\n  "url": "/",\n  "envs": {\n    "NODE_NAME": "higress-worker2",\n    "PATH": "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",\n    "POD_IP": "10.244.1.7",\n    "POD_NAME": "backend-6b9549bc64-8twnx",\n    "POD_NAMESPACE": "app-system",\n    "SERVICE_ACCOUNT": "backend",\n    "SERVICE_NAME": "backend",\n    "VERSION": "v1"\n  },\n  "host_name": "backend-6b9549bc64-8twnx",\n  "body": ""\n}\n')),(0,a.kt)("p",null,"\u54cd\u5e94\u5934\u4e2d\u548c\u8c03\u7528\u94fe\u8def\u8ddf\u8e2a\u76f8\u5173\u6709\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'"sw8": "1-MzYzMzM1NDctNTc0YS00MzZlLTgzNWEtNTY1YTQyNzk3YTY3-ZWQ3ODA2ZjYwNTI0MTFlZWE5ZDdmZTFhNTA5YTRmYTk=-1-bWlkZGxl-bWlkZGxlLTZmNGRkN2JmNmMtcWJ4cm0=-L0dFVC9zZXJ2aWNl-aHR0cDovL2JhY2tlbmQv",\n"x-httpbin-trace-host": "bff-766967f8db-jwn2g/middle-6f4dd7bf6c-qbxrm/backend-6b9549bc64-8twnx",\n"x-httpbin-trace-service": "bff/middle/backend",\n')),(0,a.kt)("p",null,"\u5176\u4e2d\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"sw8:  Skywalking \u7528\u4e8e\u8ddf\u8e2a\u7684 Http Header"),(0,a.kt)("li",{parentName:"ul"},"x-httpbin-trace-host: \u8c03\u7528\u94fe\u8def\u7ecf\u8fc7 POD_NAME"),(0,a.kt)("li",{parentName:"ul"},"x-httpbin-trace-service: \u8c03\u7528\u94fe\u8def\u7ecf\u8fc7 SERVICE_NAME")),(0,a.kt)("p",null,"\u5728 Skywalking dashboard \u4e2d\u67e5\u770b\u5982\u4e0b\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u622a\u56fe")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(4686).Z,width:"2808",height:"1422"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u8c03\u7528\u94fe\u8def\u622a\u56fe")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(4333).Z,width:"2876",height:"1492"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u8c03\u7528\u94fe\u8def\u62d3\u6251\u622a\u56fe")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(435).Z,width:"2800",height:"1424"})),(0,a.kt)("h2",{id:"\u516bhigress-gateway-\u6307\u6807\u548c\u76d1\u63a7\u9762\u677f"},"\u516b\u3001Higress gateway \u6307\u6807\u548c\u76d1\u63a7\u9762\u677f"),(0,a.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7\u5ea6\u91cf\u5404\u4e2a\u7ec4\u4ef6\u7684\u6027\u80fd\u6307\u6807\uff0c\u4f8b\u5982\u54cd\u5e94\u65f6\u95f4\u3001\u541e\u5410\u91cf\u3001\u9519\u8bef\u7387\u3001\u8d44\u6e90\u4f7f\u7528\u7387\u7b49\u6307\u6807\u6765\u4e86\u89e3\u7cfb\u7edf\u7684\u72b6\u6001\u548c\u6027\u80fd\u3002"),(0,a.kt)("p",null,"\u6307\u6807\u6570\u636e\u5305\u542b\u6307\u6807\u540d\u79f0\uff0c\u6307\u6807\u6807\u7b7e\uff0c\u548c\u6307\u6807\u503c\uff0c\u4e0b\u9762\u662f envoy_cluster_upstream_cx_total upstream\uff08\u603b\u8fde\u63a5\u6570\uff09\u90e8\u5206\u6307\u6807\u6570\u636e\uff0c"),(0,a.kt)("p",null,"\u5176\u4e2d envoy_cluster_upstream_cx_total \u662f\u6307\u6807\u540d\u79f0\uff0ccluster_name \u662f\u6307\u6807\u6807\u7b7e\uff0c16 \u662f\u6307\u6807\u503c\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'# TYPE envoy_cluster_upstream_cx_total counter\nenvoy_cluster_upstream_cx_total{cluster_name="outbound|80||bff.app-system.svc.cluster.local"} 16\n')),(0,a.kt)("p",null,"Higress \u6307\u6807\u6570\u636e\u5927\u4f53\u53ef\u4ee5\u5206\u4e3a\u4e09\u7c7b:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Downstream \u4e0b\u6e38: \u6307\u6807\u4e0e\u5916\u6765\u7684\u8fde\u63a5/\u8bf7\u6c42\u6709\u5173\uff0c\u4e3b\u8981\u7531\u4fa6\u542c\u5668\uff0cHTTP\u8fde\u63a5\u7ba1\u7406\u5668\u7b49"),(0,a.kt)("li",{parentName:"ul"},"UpStream \u4e0a\u6e38: \u6307\u6807\u4e0e\u5916\u5411\u7684\u8fde\u63a5/\u8bf7\u6c42\u6709\u5173\uff0c\u4e3b\u8981\u7531\u8fde\u63a5\u6c60\uff0c\u8def\u7531\u5668\uff0c\u8fc7\u6ee4\u5668\uff0c\u7194\u65ad\u7b49"),(0,a.kt)("li",{parentName:"ul"},"Server \u8d1f\u8f7d: \u6307\u6807\u4fe1\u606f\u8bb0\u5f55 Higress gateway \u670d\u52a1\u5668\u5b9e\u4f8b\u7684\u8d1f\u8f7d\u7b49")),(0,a.kt)("p",null,"Higress \u6307\u6807\u6570\u636e\u7c7b\u578b\u4e3b\u8981\u6709\u4e09\u7c7b:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Counter: \u65e0\u7b26\u53f7\u6574\u6570\uff0c\u53ea\u4f1a\u589e\u52a0\u800c\u4e0d\u4f1a\u51cf\u5c11\u3002\u4f8b\u5982\uff0c\u603b\u8bf7\u6c42"),(0,a.kt)("li",{parentName:"ul"},"Gauge: \u589e\u52a0\u548c\u51cf\u5c11\u7684\u65e0\u7b26\u53f7\u6574\u6570\u3002\u4f8b\u5982\uff0c\u5f53\u524d\u6d3b\u52a8\u7684\u8bf7\u6c42"),(0,a.kt)("li",{parentName:"ul"},"Histogram: \u4f5c\u4e3a\u6307\u6807\u6d41\u7684\u4e00\u90e8\u5206\u7684\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u7136\u540e\u7531\u6536\u96c6\u5668\u805a\u5408\u4ee5\u6700\u7ec8\u4ea7\u751f\u6c47\u603b\u7684\u767e\u5206\u4f4d\u503c(percentile\uff0c\u5373\u5e73\u5e38\u8bf4\u7684 P99/P50/Pxx)\u3002\u4f8b\u5982\uff0cUpstream \u54cd\u5e94\u65f6\u95f4")),(0,a.kt)("p",null,"\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u83b7\u53d6 Higress gateway \u652f\u6301\u7684\u6307\u6807\u548c\u7c7b\u578b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'$ export HIGRESS_GATEWAY_POD=$(kubectl get pods -l app=higress-gateway -o \'jsonpath={.items[0].metadata.name}\' -n higress-system)\n$ kubectl exec "$HIGRESS_GATEWAY_POD"  -n higress-system  -- curl -sS http://127.0.0.1:15020/stats/prometheus | grep "# TYPE"  \n')),(0,a.kt)("p",null,"\u90e8\u5206\u6307\u6807\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"...\n# TYPE envoy_cluster_upstream_cx_total counter\n# TYPE envoy_cluster_upstream_cx_tx_bytes_total counter\n# TYPE envoy_cluster_upstream_flow_control_backed_up_total counter\n# TYPE envoy_cluster_upstream_flow_control_drained_total counter\n# TYPE envoy_cluster_upstream_flow_control_paused_reading_total counter\n# TYPE envoy_cluster_upstream_flow_control_resumed_reading_total counter\n# TYPE envoy_cluster_upstream_internal_redirect_failed_total counter\n# TYPE envoy_cluster_upstream_internal_redirect_succeeded_total counter\n# TYPE envoy_cluster_upstream_rq counter\n# TYPE envoy_cluster_upstream_rq_101 counter\n# TYPE envoy_cluster_upstream_rq_200 counter\n# TYPE envoy_cluster_upstream_rq_201 counter\n# TYPE envoy_cluster_upstream_rq_301 counter\n# TYPE envoy_cluster_upstream_rq_302 counter\n# TYPE envoy_cluster_upstream_rq_304 counter\n# TYPE envoy_cluster_upstream_rq_401 counter\n# TYPE envoy_cluster_upstream_rq_404 counter\n# TYPE envoy_cluster_upstream_rq_cancelled counter\n# TYPE envoy_cluster_upstream_rq_completed counter\n# TYPE envoy_cluster_upstream_rq_maintenance_mode counter\n# TYPE envoy_cluster_upstream_rq_max_duration_reached counter\n# TYPE envoy_cluster_upstream_rq_pending_failure_eject counter\n# TYPE envoy_cluster_upstream_rq_pending_overflow counter\n# TYPE envoy_cluster_upstream_rq_pending_total counter\n# TYPE envoy_cluster_upstream_rq_per_try_idle_timeout counter\n# TYPE envoy_cluster_upstream_rq_per_try_timeout counter\n# TYPE envoy_cluster_upstream_rq_retry counter\n# TYPE envoy_cluster_upstream_rq_retry_backoff_exponential counter\n# TYPE envoy_cluster_upstream_rq_retry_backoff_ratelimited counter\n# TYPE envoy_cluster_upstream_rq_retry_limit_exceeded counter\n# TYPE envoy_cluster_upstream_rq_retry_overflow counter\n# TYPE envoy_cluster_upstream_rq_retry_success counter\n# TYPE envoy_cluster_upstream_rq_rx_reset counter\n# TYPE envoy_cluster_upstream_rq_timeout counter\n# TYPE envoy_cluster_upstream_rq_total counter\n# TYPE envoy_cluster_upstream_rq_tx_reset counter\n...\n# TYPE envoy_http_downstream_cx_total counter\n# TYPE envoy_http_downstream_cx_tx_bytes_total counter\n# TYPE envoy_http_downstream_cx_upgrades_total counter\n# TYPE envoy_http_downstream_flow_control_paused_reading_total counter\n# TYPE envoy_http_downstream_flow_control_resumed_reading_total counter\n# TYPE envoy_http_downstream_rq counter\n# TYPE envoy_http_downstream_rq_completed counter\n# TYPE envoy_http_downstream_rq_failed_path_normalization counter\n# TYPE envoy_http_downstream_rq_header_timeout counter\n# TYPE envoy_http_downstream_rq_http1_total counter\n# TYPE envoy_http_downstream_rq_http2_total counter\n# TYPE envoy_http_downstream_rq_http3_total counter\n# TYPE envoy_http_downstream_rq_idle_timeout counter\n# TYPE envoy_http_downstream_rq_max_duration_reached counter\n# TYPE envoy_http_downstream_rq_non_relative_path counter\n# TYPE envoy_http_downstream_rq_overload_close counter\n# TYPE envoy_http_downstream_rq_redirected_with_normalized_path counter\n# TYPE envoy_http_downstream_rq_rejected_via_ip_detection counter\n# TYPE envoy_http_downstream_rq_response_before_rq_complete counter\n# TYPE envoy_http_downstream_rq_rx_reset counter\n# TYPE envoy_http_downstream_rq_timeout counter\n# TYPE envoy_http_downstream_rq_too_large counter\n# TYPE envoy_http_downstream_rq_total counter\n# TYPE envoy_http_downstream_rq_tx_reset counter\n# TYPE envoy_http_downstream_rq_ws_on_non_ws_route counter\n...\n")),(0,a.kt)("p",null,"\u5177\u4f53\u6307\u6807\u5b9a\u4e49\u53c2\u8003\u5982\u4e0b\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/upstream/cluster_manager/cluster_stats"},"cluster manager")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/stats"},"http connection manager")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/stats"},"listeners")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/statistics"},"server"))),(0,a.kt)("p",null,"\u5982\u4f55\u67e5\u770b Higress \u6307\u6807\u6570\u636e\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 ",(0,a.kt)("a",{parentName:"li",href:"http://console.higress.io:8080/dashboard"},"http://console.higress.io:8080/dashboard")," \u67e5\u770b Higress gateway \u76d1\u63a7\u9762\u677f"),(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 Skywalking Dashboard \u67e5\u770b Higress gateway \u76d1\u63a7\u6570\u636e")),(0,a.kt)("p",null,"\u901a\u8fc7 Skywalking Dashboard \u67e5\u770b Higress gateway \u76d1\u63a7\u6570\u636e\u90e8\u5206\u622a\u56fe\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img.png",src:n(1438).Z,width:"2176",height:"854"}),"\n",(0,a.kt)("img",{alt:"img.png",src:n(9458).Z,width:"2176",height:"904"}),"\n",(0,a.kt)("img",{alt:"img.png",src:n(9151).Z,width:"2170",height:"1092"})),(0,a.kt)("h2",{id:"\u53c2\u8003\u6587\u6863"},"\u53c2\u8003\u6587\u6863"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://istio.io/latest/docs/tasks/observability/distributed-tracing/skywalking/"},"https://istio.io/latest/docs/tasks/observability/distributed-tracing/skywalking/")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"http://peter.bourgon.org/blog/2017/02/21/metrics-tracing-and-logging.html"},"http://peter.bourgon.org/blog/2017/02/21/metrics-tracing-and-logging.html")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://skywalking.apache.org/docs/main/next/en/api/x-process-propagation-headers-v3/"},"https://skywalking.apache.org/docs/main/next/en/api/x-process-propagation-headers-v3/")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://skywalking.apache.org/docs/main/next/en/api/trace-data-protocol-v3/"},"https://skywalking.apache.org/docs/main/next/en/api/trace-data-protocol-v3/"))))}g.isMDXComponent=!0},4225:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress-d2e17031336b9178c2668d80ff818c5b.png"},5297:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress1-67659805b3a2379e1b1763bded3a578f.png"},716:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress12-cfd41d730d22a7648fcc1f6d06765fb8.png"},5506:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress13-213da6eb6d44a461df9b933067002f4e.png"},1438:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress14-274da38a0b0af5a8fa09d20ab5a7bbb5.png"},9458:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress15-63b1535591a4393a1b9a030856749790.png"},9151:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress16-8236b7f058860b440ab64c2ec997f6d5.png"},8981:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress2-c487b42954d302305876710cc8b52dce.png"},9502:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress3-be62e59d28067affe19a9bad51bca50a.png"},4686:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress4-1-240819472e8b9f06168eaa65df92e264.png"},4333:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress4-a208c269e0dbade2c394ae0cce089e17.png"},435:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/higress5-76307325468b090967c1bfaecf84af64.png"},3764:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/skywalking1-b2464b380f61dc6e13853ec4ad648e8a.png"},885:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/skywalking_trace-ae4a862a6abced391f00069e9ed32f26.png"}}]);